

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PyNucleus_fem.mesh &#8212; PyNucleus  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bizstyle.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">PyNucleus  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../PyNucleus_fem.html" accesskey="U">PyNucleus_fem</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">PyNucleus_fem.mesh</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for PyNucleus_fem.mesh</h1><div class="highlight"><pre>
<span></span><span class="c1">###################################################################################</span>
<span class="c1"># Copyright 2021 National Technology &amp; Engineering Solutions of Sandia,           #</span>
<span class="c1"># LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the           #</span>
<span class="c1"># U.S. Government retains certain rights in this software.                        #</span>
<span class="c1"># If you want to use this code, please refer to the README.rst and LICENSE files. #</span>
<span class="c1">###################################################################################</span>


<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">mpi4py.rc</span>
<span class="n">mpi4py</span><span class="o">.</span><span class="n">rc</span><span class="o">.</span><span class="n">initialize</span> <span class="o">=</span> <span class="kc">False</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="k">as</span> <span class="nn">la</span>
<span class="kn">from</span> <span class="nn">PyNucleus_base.factory</span> <span class="kn">import</span> <span class="n">factory</span>
<span class="kn">from</span> <span class="nn">PyNucleus_base.myTypes</span> <span class="kn">import</span> <span class="n">INDEX</span><span class="p">,</span> <span class="n">REAL</span><span class="p">,</span> <span class="n">TAG</span>
<span class="kn">from</span> <span class="nn">PyNucleus_base.linear_operators</span> <span class="kn">import</span> <span class="n">sparseGraph</span>
<span class="kn">from</span> <span class="nn">PyNucleus_base</span> <span class="kn">import</span> <span class="n">uninitialized</span><span class="p">,</span> <span class="n">uninitialized_like</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="n">meshCy</span> <span class="kn">import</span> <span class="p">(</span><span class="n">meshBase</span><span class="p">,</span>
                      <span class="n">boundaryVertices</span><span class="p">,</span>
                      <span class="n">boundaryEdges</span><span class="p">,</span>
                      <span class="n">boundaryFaces</span><span class="p">,</span>
                      <span class="n">boundaryVerticesFromBoundaryEdges</span><span class="p">,</span>
                      <span class="n">boundaryEdgesFromBoundaryFaces</span><span class="p">,</span>
                      <span class="n">radialMeshTransformation</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="n">meshPartitioning</span> <span class="kn">import</span> <span class="p">(</span><span class="n">metisMeshPartitioner</span><span class="p">,</span>
                                <span class="n">regularMeshPartitioner</span><span class="p">,</span>
                                <span class="n">PartitionerException</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># PHYSICAL is the physical boundary of the entire domain</span>
<span class="n">PHYSICAL</span> <span class="o">=</span> <span class="n">TAG</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># INTERIOR_NONOVERLAPPING are the interior boundaries of</span>
<span class="c1"># non-overlapping subdomains</span>
<span class="n">INTERIOR_NONOVERLAPPING</span> <span class="o">=</span> <span class="n">TAG</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># INTERIOR is the interior boundary of overlapping subdomains</span>
<span class="n">INTERIOR</span> <span class="o">=</span> <span class="n">TAG</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># don&#39;t use any boundary</span>
<span class="n">NO_BOUNDARY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">TAG</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>

<span class="c1"># Types of boundary conditions</span>
<span class="n">DIRICHLET</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">NEUMANN</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">HOMOGENEOUS_DIRICHLET</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">HOMOGENEOUS_NEUMANN</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">NORM</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">boundaryConditions</span> <span class="o">=</span> <span class="p">{</span><span class="n">DIRICHLET</span><span class="p">:</span> <span class="s1">&#39;Dirichlet&#39;</span><span class="p">,</span>
                      <span class="n">NEUMANN</span><span class="p">:</span> <span class="s1">&#39;Neumann&#39;</span><span class="p">,</span>
                      <span class="n">HOMOGENEOUS_DIRICHLET</span><span class="p">:</span> <span class="s1">&#39;homogeneous Dirichlet&#39;</span><span class="p">,</span>
                      <span class="n">HOMOGENEOUS_NEUMANN</span><span class="p">:</span> <span class="s1">&#39;homogeneous Neumann&#39;</span><span class="p">}</span>


<div class="viewcode-block" id="meshFactory"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshFactory">[docs]</a><span class="k">class</span> <span class="nc">meshFactory</span><span class="p">(</span><span class="n">factory</span><span class="p">):</span>
<div class="viewcode-block" id="meshFactory.__init__"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshFactory.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">meshFactory</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="meshFactory.register"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshFactory.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">classType</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{},</span> <span class="n">aliases</span><span class="o">=</span><span class="p">[]):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">meshFactory</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">classType</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">aliases</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCanonicalName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dim</span></div>

<div class="viewcode-block" id="meshFactory.build"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshFactory.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">noRef</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hTarget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">meshNd</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span>
        
        <span class="n">mesh</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">meshFactory</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">surface</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">get_surface_mesh</span><span class="p">()</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">removeUnusedVertices</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">P1_DoFMap</span>
        <span class="n">dmTest</span> <span class="o">=</span> <span class="n">P1_DoFMap</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">PHYSICAL</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">dmTest</span><span class="o">.</span><span class="n">num_dofs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">refine</span><span class="p">()</span>
            <span class="n">dmTest</span> <span class="o">=</span> <span class="n">P1_DoFMap</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">PHYSICAL</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hTarget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">noRef</span><span class="p">):</span>
                <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">refine</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">hTarget</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">mesh</span><span class="o">.</span><span class="n">h</span> <span class="o">&gt;</span> <span class="n">hTarget</span><span class="p">:</span>
                <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">refine</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">mesh</span></div>

<div class="viewcode-block" id="meshFactory.getDim"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshFactory.getDim">[docs]</a>    <span class="k">def</span> <span class="nf">getDim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCanonicalName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="pacman"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.pacman">[docs]</a><span class="k">def</span> <span class="nf">pacman</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshConstruction</span> <span class="kn">import</span> <span class="p">(</span><span class="n">circularSegment</span><span class="p">,</span>
                                    <span class="n">line</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
    <span class="n">bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)])</span>

    <span class="n">numPointsPerUnitLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">h</span><span class="p">))</span>

    <span class="n">domain</span> <span class="o">=</span> <span class="p">(</span><span class="n">circularSegment</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">numPointsPerUnitLength</span><span class="p">)</span> <span class="o">+</span>
              <span class="n">line</span><span class="p">(</span><span class="n">bottom</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span><span class="o">+</span>
              <span class="n">line</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">top</span><span class="p">))</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">max_volume</span><span class="o">=</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_angle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="uniformSquare"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.uniformSquare">[docs]</a><span class="k">def</span> <span class="nf">uniformSquare</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">crossed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">M</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">N</span>
    <span class="k">assert</span> <span class="n">N</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">M</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ay</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span> <span class="k">for</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="ow">in</span>
                <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())]</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">crossed</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># bottom right element</span>
                <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                <span class="c1"># top left element</span>
                <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
                <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># bottom right element</span>
                        <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                        <span class="c1"># top left element</span>
                        <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># bottom left element</span>
                        <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
                        <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                        <span class="c1"># top right element</span>
                        <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># bottom right element</span>
                        <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                        <span class="c1"># top left element</span>
                        <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># bottom left element</span>
                        <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
                        <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                        <span class="c1"># top right element</span>
                        <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
                <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span></div>


<div class="viewcode-block" id="simpleSquare"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.simpleSquare">[docs]</a><span class="k">def</span> <span class="nf">simpleSquare</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">uniformSquare</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="crossSquare"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.crossSquare">[docs]</a><span class="k">def</span> <span class="nf">crossSquare</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">uniformSquare</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">crossed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="gradedSquare"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.gradedSquare">[docs]</a><span class="k">def</span> <span class="nf">gradedSquare</span><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshCy</span> <span class="kn">import</span> <span class="nn">gradedHypercubeTransformer</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                            <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
                            <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setMeshTransformation</span><span class="p">(</span><span class="n">gradedHypercubeTransformer</span><span class="p">(</span><span class="n">factor</span><span class="p">))</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">refine</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="simpleInterval"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.simpleInterval">[docs]</a><span class="k">def</span> <span class="nf">simpleInterval</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">numCells</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numCells</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numCells</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numCells</span><span class="p">):</span>
        <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">numCells</span><span class="p">)</span>
        <span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">mesh1d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>


<div class="viewcode-block" id="disconnectedInterval"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.disconnectedInterval">[docs]</a><span class="k">def</span> <span class="nf">disconnectedInterval</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
                         <span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">sep</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span>
                         <span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="n">sep</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span>
                         <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh1d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>


<div class="viewcode-block" id="getNodes"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.getNodes">[docs]</a><span class="k">def</span> <span class="nf">getNodes</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">strictInteraction</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">diam</span> <span class="o">=</span> <span class="n">b</span><span class="o">-</span><span class="n">a</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">INDEX</span><span class="p">(</span><span class="n">diam</span><span class="o">/</span><span class="n">h</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span> <span class="o">&lt;</span> <span class="n">diam</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
    <span class="n">hInterior</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">INDEX</span><span class="p">(</span><span class="n">horizon</span><span class="o">/</span><span class="n">hInterior</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">k</span><span class="o">*</span><span class="n">hInterior</span> <span class="o">&lt;</span> <span class="n">horizon</span><span class="o">-</span><span class="mf">1e-8</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">strictInteraction</span><span class="p">:</span>
        <span class="n">horizon</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">hInterior</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">horizon</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                       <span class="n">nodes</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="n">horizon</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))</span>
    <span class="k">return</span> <span class="n">nodes</span></div>


<div class="viewcode-block" id="intervalWithInteraction"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.intervalWithInteraction">[docs]</a><span class="k">def</span> <span class="nf">intervalWithInteraction</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strictInteraction</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">horizon</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">getNodes</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">strictInteraction</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">num_vertices</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="n">num_vertices</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">cells</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_vertices</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">cells</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh1d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>


<div class="viewcode-block" id="doubleIntervalWithInteractions"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.doubleIntervalWithInteractions">[docs]</a><span class="k">def</span> <span class="nf">doubleIntervalWithInteractions</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                                   <span class="n">horizon1</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">horizon2</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                   <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">getNumCells</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-5</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">-</span><span class="n">eps</span><span class="p">)</span><span class="o">/</span><span class="n">h</span><span class="p">))</span>

    <span class="k">assert</span> <span class="n">horizon2</span> <span class="o">&gt;=</span> <span class="n">horizon1</span>
    <span class="k">assert</span> <span class="n">horizon1</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">horizon1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">horizon1</span>
        <span class="k">elif</span> <span class="n">horizon2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">horizon2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">horizon1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">horizon2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">])</span>

    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">horizon1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">horizon1</span><span class="p">)</span>
    <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">horizon2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">horizon2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">horizon1</span> <span class="o">!=</span> <span class="n">horizon2</span><span class="p">:</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">horizon1</span><span class="p">)</span>
    <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">horizon2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">horizon1</span> <span class="o">!=</span> <span class="n">horizon2</span><span class="p">:</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">horizon1</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">horizon2</span><span class="p">)</span>
    <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">horizon2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">horizon2</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">getNumCells</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">getNumCells</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">num_vertices</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="n">num_vertices</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">cells</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_vertices</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">cells</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh1d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>


<div class="viewcode-block" id="squareWithInteractions"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.squareWithInteractions">[docs]</a><span class="k">def</span> <span class="nf">squareWithInteractions</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span>
                           <span class="n">horizon</span><span class="p">,</span>
                           <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">uniform</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">strictInteraction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">innerRadius</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">preserveLinesHorizontal</span><span class="o">=</span><span class="p">[],</span>
                           <span class="n">preserveLinesVertical</span><span class="o">=</span><span class="p">[],</span>
                           <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">horizon</span>
    <span class="k">if</span> <span class="n">innerRadius</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">uniform</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">uniform</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshConstruction</span> <span class="kn">import</span> <span class="p">(</span><span class="n">circularSegment</span><span class="p">,</span>
                                        <span class="n">line</span><span class="p">,</span>
                                        <span class="n">transformationRestriction</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">horizon</span>
        <span class="n">bottomLeft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">])</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">ax</span><span class="o">+</span><span class="n">bx</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">ay</span><span class="o">+</span><span class="n">by</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">numPointsPerUnitLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">h</span><span class="p">))</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">preserveLinesVertical</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">preserveLinesHorizontal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">preserveLinesVertical</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">preserveLinesHorizontal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">preserve</span> <span class="o">=</span> <span class="n">preserveLinesVertical</span><span class="o">+</span><span class="n">preserveLinesHorizontal</span>

            <span class="n">c1</span> <span class="o">=</span> <span class="n">circularSegment</span><span class="p">(</span><span class="n">bottomLeft</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">numPointsPerUnitLength</span><span class="p">)</span>

            <span class="n">x1</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="n">line</span><span class="p">((</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">ay</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preserve</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="o">+</span><span class="n">line</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">ay</span><span class="p">))</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="o">+</span><span class="n">line</span><span class="p">((</span><span class="n">x2</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">ay</span><span class="p">))</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="o">+</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">horizon</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">circularSegment</span><span class="p">(</span><span class="n">bottomLeft</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">numPointsPerUnitLength</span><span class="p">)</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="n">line</span><span class="p">((</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">ay</span><span class="p">))</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="o">+</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">horizon</span><span class="p">))</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="n">line</span><span class="p">((</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="o">-</span><span class="n">horizon</span><span class="p">))</span>
        <span class="n">c4</span> <span class="o">=</span> <span class="n">line</span><span class="p">((</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">ax</span><span class="o">-</span><span class="n">horizon</span><span class="p">,</span> <span class="n">ay</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">c1</span><span class="o">+</span><span class="n">c2</span><span class="o">+</span><span class="n">c3</span><span class="o">+</span><span class="n">c4</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">preserveLinesVertical</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">line</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">ay</span><span class="o">-</span><span class="n">horizon</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ay</span><span class="p">))</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">line</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preserve</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">d</span> <span class="o">+=</span> <span class="n">line</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">line</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">by</span><span class="p">))</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">line</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">by</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">by</span><span class="o">+</span><span class="n">horizon</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">preserveLinesVertical</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">ax</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">bx</span>
                <span class="n">frame</span> <span class="o">+=</span> <span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">preserveLinesHorizontal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">line</span><span class="p">((</span><span class="n">ax</span><span class="o">-</span><span class="n">horizon</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">+</span><span class="n">line</span><span class="p">((</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">+</span><span class="n">line</span><span class="p">((</span><span class="n">bx</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="o">+</span><span class="n">horizon</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">line</span><span class="p">((</span><span class="n">ax</span><span class="o">-</span><span class="n">horizon</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">line</span><span class="p">((</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preserve</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">d</span> <span class="o">+=</span> <span class="n">line</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">preserve</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">line</span><span class="p">((</span><span class="n">x2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">line</span><span class="p">((</span><span class="n">bx</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="o">+</span><span class="n">horizon</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">preserveLinesHorizontal</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">ay</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">by</span>
                <span class="n">frame</span> <span class="o">+=</span> <span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">innerRadius</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">+=</span> <span class="n">transformationRestriction</span><span class="p">(</span><span class="n">circularSegment</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">innerRadius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">numPointsPerUnitLength</span><span class="p">),</span> <span class="n">center</span><span class="o">-</span><span class="p">(</span><span class="n">innerRadius</span><span class="p">,</span> <span class="n">innerRadius</span><span class="p">),</span> <span class="n">center</span><span class="o">+</span><span class="p">(</span><span class="n">innerRadius</span><span class="p">,</span> <span class="n">innerRadius</span><span class="p">))</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">max_volume</span><span class="o">=</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_angle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">holes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">max_volume</span><span class="o">=</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_angle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-10</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">ay</span><span class="o">-</span><span class="n">eps</span><span class="p">,</span>
                                               <span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">by</span><span class="o">+</span><span class="n">eps</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">bx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">ay</span><span class="o">-</span><span class="n">eps</span><span class="p">,</span>
                                               <span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">by</span><span class="o">+</span><span class="n">eps</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">M1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ay</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">ax</span><span class="o">-</span><span class="n">eps</span><span class="p">,</span>
                                               <span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bx</span><span class="o">+</span><span class="n">eps</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">M2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">by</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">ax</span><span class="o">-</span><span class="n">eps</span><span class="p">,</span>
                                               <span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bx</span><span class="o">+</span><span class="n">eps</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">N1</span> <span class="o">==</span> <span class="n">N2</span>
            <span class="k">assert</span> <span class="n">M1</span> <span class="o">==</span> <span class="n">M2</span>
            <span class="n">mesh2</span> <span class="o">=</span> <span class="n">uniformSquare</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N1</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">M1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="o">=</span><span class="n">ay</span><span class="p">,</span> <span class="n">bx</span><span class="o">=</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="n">by</span><span class="p">)</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">snapMeshes</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">mesh2</span><span class="p">)</span>

        <span class="n">location</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-9</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">preserveLinesVertical</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vertexNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">-</span><span class="n">eps</span><span class="p">:</span>
                    <span class="n">location</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">+</span><span class="n">eps</span><span class="p">:</span>
                    <span class="n">location</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">location</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
                <span class="n">cellLoc</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">vertexNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">cellLoc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo</span><span class="p">]])</span>
                <span class="k">assert</span> <span class="nb">max</span><span class="p">(</span><span class="n">cellLoc</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">cellLoc</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">cells_as_array</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:],</span> <span class="n">cellLoc</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">preserveLinesHorizontal</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vertexNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y</span><span class="o">-</span><span class="n">eps</span><span class="p">:</span>
                    <span class="n">location</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="o">+</span><span class="n">eps</span><span class="p">:</span>
                    <span class="n">location</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">location</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
                <span class="n">cellLoc</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">vertexNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">cellLoc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo</span><span class="p">]])</span>
                <span class="k">assert</span> <span class="nb">max</span><span class="p">(</span><span class="n">cellLoc</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">cellLoc</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">cells_as_array</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">getNodes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">strictInteraction</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">getNodes</span><span class="p">(</span><span class="n">ay</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">strictInteraction</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span> <span class="k">for</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="ow">in</span>
                    <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())]</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># bottom right element</span>
                <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                <span class="c1"># top left element</span>
                <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
                <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="doubleSquareWithInteractions"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.doubleSquareWithInteractions">[docs]</a><span class="k">def</span> <span class="nf">doubleSquareWithInteractions</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">ay</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">bx</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">cx</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">cy</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                                 <span class="n">horizon1</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">horizon2</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                 <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">returnSketch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshConstruction</span> <span class="kn">import</span> <span class="p">(</span><span class="n">circularSegment</span><span class="p">,</span>
                                    <span class="n">line</span><span class="p">,</span>
                                    <span class="n">polygon</span><span class="p">,</span>
                                    <span class="n">transformationRestriction</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">horizon2</span> <span class="o">&gt;=</span> <span class="n">horizon1</span>
    <span class="k">assert</span> <span class="n">horizon1</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">horizon1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">horizon1</span>
        <span class="k">elif</span> <span class="n">horizon2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">horizon2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">horizon1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">horizon2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">])</span>

    <span class="n">bottomLeft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">])</span>
    <span class="n">bottomMid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bx</span><span class="p">,</span> <span class="n">ay</span><span class="p">])</span>
    <span class="n">bottomRight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cx</span><span class="p">,</span> <span class="n">ay</span><span class="p">])</span>
    <span class="n">topLeft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax</span><span class="p">,</span> <span class="n">by</span><span class="p">])</span>
    <span class="n">topMid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">])</span>
    <span class="n">topRight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cx</span><span class="p">,</span> <span class="n">by</span><span class="p">])</span>

    <span class="n">centerLeft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">ax</span><span class="o">+</span><span class="n">bx</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">ay</span><span class="o">+</span><span class="n">by</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">centerRight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">bx</span><span class="o">+</span><span class="n">cx</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">ay</span><span class="o">+</span><span class="n">cy</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">numPointsPerUnitLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="mf">0.8</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">/</span><span class="mi">2</span><span class="p">))))</span>

        <span class="k">if</span> <span class="n">horizon2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">magicAngle</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">horizon1</span><span class="o">/</span><span class="n">horizon2</span><span class="p">)</span>
            <span class="n">magicLen</span> <span class="o">=</span> <span class="n">horizon2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">magicAngle</span><span class="p">)</span>

            <span class="c1"># the four/six inner squares</span>
            <span class="n">inner</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">([</span><span class="n">bottomLeft</span><span class="p">,</span> <span class="n">bottomMid</span><span class="o">-</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                             <span class="n">topMid</span><span class="o">-</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">topLeft</span><span class="p">],</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">horizon1</span> <span class="o">&lt;</span> <span class="n">horizon2</span><span class="p">:</span>
                <span class="n">inner</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">([</span><span class="n">bottomMid</span><span class="o">-</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bottomMid</span><span class="o">-</span><span class="p">(</span><span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                  <span class="n">topMid</span><span class="o">-</span><span class="p">(</span><span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">topMid</span><span class="o">-</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">doClose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
                <span class="n">inner</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">([</span><span class="n">bottomMid</span><span class="o">-</span><span class="p">(</span><span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bottomMid</span><span class="p">,</span>
                                  <span class="n">topMid</span><span class="p">,</span> <span class="n">topMid</span><span class="o">-</span><span class="p">(</span><span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">doClose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
                <span class="n">inner</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">([</span><span class="n">bottomMid</span><span class="p">,</span> <span class="n">bottomMid</span><span class="o">+</span><span class="p">(</span><span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                  <span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">topMid</span><span class="p">],</span> <span class="n">doClose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
                <span class="n">inner</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">([</span><span class="n">bottomMid</span><span class="o">+</span><span class="p">(</span><span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bottomMid</span><span class="o">+</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                  <span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">doClose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inner</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">([</span><span class="n">bottomMid</span><span class="o">-</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bottomMid</span><span class="p">,</span>
                                  <span class="n">topMid</span><span class="p">,</span> <span class="n">topMid</span><span class="o">-</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">doClose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
                <span class="n">inner</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">([</span><span class="n">bottomMid</span><span class="p">,</span> <span class="n">bottomMid</span><span class="o">+</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                  <span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">topMid</span><span class="p">],</span> <span class="n">doClose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
            <span class="n">inner</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">([</span><span class="n">bottomMid</span><span class="o">+</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bottomRight</span><span class="p">,</span>
                              <span class="n">topRight</span><span class="p">,</span> <span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">doClose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inner</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">([</span><span class="n">bottomLeft</span><span class="p">,</span> <span class="n">bottomMid</span><span class="p">,</span> <span class="n">topMid</span><span class="p">,</span> <span class="n">topLeft</span><span class="p">],</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
            <span class="n">inner</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">([</span><span class="n">bottomMid</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">,</span> <span class="n">topRight</span><span class="p">,</span> <span class="n">topMid</span><span class="p">],</span> <span class="n">doClose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>

            <span class="n">mesh</span> <span class="o">=</span> <span class="n">inner</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="o">*</span><span class="mf">0.8</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">inner</span>

        <span class="k">if</span> <span class="n">horizon2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># interaction domain for right domain</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">bottomMid</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">horizon2</span><span class="p">)</span> <span class="o">+</span> <span class="n">circularSegment</span><span class="p">(</span><span class="n">bottomRight</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">numPointsPerUnitLength</span><span class="p">))</span>
            <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">bottomRight</span><span class="p">,</span> <span class="n">topRight</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">circularSegment</span><span class="p">(</span><span class="n">topRight</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">numPointsPerUnitLength</span><span class="p">))</span>
            <span class="n">d3</span> <span class="o">=</span> <span class="p">((</span><span class="n">line</span><span class="p">(</span><span class="n">topRight</span><span class="p">,</span> <span class="n">topMid</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">))</span> <span class="o">+</span>
                  <span class="n">transformationRestriction</span><span class="p">(</span><span class="n">circularSegment</span><span class="p">(</span><span class="n">topMid</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="n">magicAngle</span><span class="p">,</span> <span class="n">numPointsPerUnitLength</span><span class="p">),</span> <span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">horizon2</span><span class="p">,</span> <span class="n">horizon1</span><span class="o">+</span><span class="mf">1e-9</span><span class="p">),</span> <span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">))</span> <span class="o">+</span>
                  <span class="n">transformationRestriction</span><span class="p">(</span><span class="n">circularSegment</span><span class="p">(</span><span class="n">topMid</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">magicAngle</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">numPointsPerUnitLength</span><span class="p">),</span> <span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">magicLen</span><span class="o">-</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">)))</span>
            <span class="n">d4</span> <span class="o">=</span> <span class="p">(</span><span class="n">transformationRestriction</span><span class="p">(</span><span class="n">circularSegment</span><span class="p">(</span><span class="n">bottomMid</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">magicAngle</span><span class="p">),</span> <span class="n">numPointsPerUnitLength</span><span class="p">),</span> <span class="n">bottomMid</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">horizon2</span><span class="p">,</span> <span class="o">-</span><span class="n">horizon1</span><span class="o">+</span><span class="mf">1e-9</span><span class="p">),</span> <span class="n">bottomMid</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">magicLen</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span>
                  <span class="n">transformationRestriction</span><span class="p">(</span><span class="n">circularSegment</span><span class="p">(</span><span class="n">bottomMid</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">magicAngle</span><span class="p">),</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">numPointsPerUnitLength</span><span class="p">),</span> <span class="n">bottomMid</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">horizon2</span><span class="p">,</span> <span class="o">-</span><span class="n">horizon2</span><span class="p">),</span> <span class="n">bottomMid</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">horizon1</span><span class="o">-</span><span class="mf">1e-9</span><span class="p">)))</span>
            <span class="n">outer</span> <span class="o">=</span> <span class="n">d1</span><span class="o">+</span><span class="n">d2</span><span class="o">+</span><span class="n">d3</span><span class="o">+</span><span class="n">d4</span>

            <span class="c1"># two right corners</span>
            <span class="n">c6</span> <span class="o">=</span> <span class="n">line</span><span class="p">(</span><span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="o">-</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">))</span> <span class="o">+</span> <span class="n">line</span><span class="p">(</span><span class="n">bottomRight</span><span class="p">,</span> <span class="n">bottomRight</span><span class="o">+</span><span class="p">(</span><span class="n">horizon2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">c6</span> <span class="o">=</span> <span class="n">c6</span> <span class="o">+</span> <span class="p">(</span><span class="n">c6</span><span class="o">*</span><span class="p">(</span><span class="n">centerRight</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
            <span class="n">outer</span> <span class="o">+=</span> <span class="n">c6</span>

            <span class="c1"># the two mid corners</span>
            <span class="n">c7</span> <span class="o">=</span> <span class="n">line</span><span class="p">(</span><span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">),</span> <span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">))</span> <span class="o">+</span> <span class="n">line</span><span class="p">(</span><span class="n">topMid</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">),</span> <span class="n">topMid</span><span class="p">)</span>
            <span class="n">c8</span> <span class="o">=</span> <span class="n">line</span><span class="p">(</span><span class="n">bottomMid</span><span class="p">,</span> <span class="n">bottomMid</span><span class="o">-</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">))</span> <span class="o">+</span> <span class="n">line</span><span class="p">(</span><span class="n">bottomMid</span><span class="o">-</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">),</span> <span class="n">bottomMid</span><span class="o">-</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon2</span><span class="p">))</span>
            <span class="n">outer</span> <span class="o">+=</span> <span class="n">c7</span><span class="o">+</span><span class="n">c8</span>

            <span class="k">if</span> <span class="n">horizon1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># interaction domain for left domain</span>
                <span class="n">e1</span> <span class="o">=</span> <span class="n">circularSegment</span><span class="p">(</span><span class="n">topMid</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
                <span class="n">e2</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">topMid</span><span class="p">,</span> <span class="n">topMid</span><span class="o">-</span><span class="p">(</span><span class="n">magicLen</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">topMid</span><span class="o">-</span><span class="p">(</span><span class="n">magicLen</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">topLeft</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">))</span>
                <span class="n">e3</span> <span class="o">=</span> <span class="n">circularSegment</span><span class="p">(</span><span class="n">topLeft</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
                <span class="n">e4</span> <span class="o">=</span> <span class="n">line</span><span class="p">(</span><span class="n">topLeft</span><span class="p">,</span> <span class="n">bottomLeft</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">e5</span> <span class="o">=</span> <span class="n">circularSegment</span><span class="p">(</span><span class="n">bottomLeft</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
                <span class="n">e6</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">bottomLeft</span><span class="p">,</span> <span class="n">bottomMid</span><span class="o">-</span><span class="p">(</span><span class="n">magicLen</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">horizon1</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">bottomMid</span><span class="o">-</span><span class="p">(</span><span class="n">magicLen</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bottomMid</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">horizon1</span><span class="p">))</span>
                <span class="n">e7</span> <span class="o">=</span> <span class="n">circularSegment</span><span class="p">(</span><span class="n">bottomMid</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerUnitLength</span><span class="p">)</span>
                <span class="n">outer</span> <span class="o">+=</span> <span class="n">e1</span><span class="o">+</span><span class="n">e2</span><span class="o">+</span><span class="n">e3</span><span class="o">+</span><span class="n">e4</span><span class="o">+</span><span class="n">e5</span><span class="o">+</span><span class="n">e6</span><span class="o">+</span><span class="n">e7</span>

            <span class="c1"># preserve right angles near corners</span>
            <span class="k">if</span> <span class="n">horizon1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># two left corners</span>
                <span class="n">c5</span> <span class="o">=</span> <span class="n">line</span><span class="p">(</span><span class="n">topLeft</span><span class="p">,</span> <span class="n">topLeft</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon1</span><span class="p">))</span><span class="o">+</span><span class="n">line</span><span class="p">(</span><span class="n">topLeft</span><span class="p">,</span> <span class="n">topLeft</span><span class="o">-</span><span class="p">(</span><span class="n">horizon1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">c5</span> <span class="o">=</span> <span class="n">c5</span> <span class="o">+</span> <span class="p">(</span><span class="n">c5</span><span class="o">*</span><span class="p">(</span><span class="n">centerLeft</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
                <span class="n">outer</span> <span class="o">+=</span> <span class="n">c5</span>

            <span class="n">frame</span> <span class="o">=</span> <span class="n">inner</span><span class="o">+</span><span class="n">outer</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="o">*</span><span class="mf">0.8</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">h</span> <span class="o">&lt;=</span> <span class="n">h</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">returnSketch</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">frame</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mesh</span>
    <span class="k">if</span> <span class="n">returnSketch</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">frame</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="discWithInteraction"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.discWithInteraction">[docs]</a><span class="k">def</span> <span class="nf">discWithInteraction</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">0.25</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">horizon</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">outerRadius</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">+</span> <span class="n">horizon</span>
        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="n">horizon</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;h = </span><span class="si">{}</span><span class="s2"> &gt; horizon = </span><span class="si">{}</span><span class="s2">. Using h=horizon instead.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">horizon</span><span class="p">))</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">horizon</span>
        <span class="k">return</span> <span class="n">circleWithInnerRadius</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">outerRadius</span><span class="o">/</span><span class="n">h</span><span class="p">),</span>
                                     <span class="n">radius</span><span class="o">=</span><span class="n">outerRadius</span><span class="p">,</span>
                                     <span class="n">innerRadius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                                     <span class="n">max_volume</span><span class="o">=</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">circle</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">radius</span><span class="o">/</span><span class="n">h</span><span class="p">),</span>
                      <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                      <span class="n">max_volume</span><span class="o">=</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="discWithIslands"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.discWithIslands">[docs]</a><span class="k">def</span> <span class="nf">discWithIslands</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">islandOffCenter</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">islandDiam</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshConstruction</span> <span class="kn">import</span> <span class="nn">circle</span><span class="o">,</span> <span class="nn">rectangle</span>
    <span class="n">numPointsPerLength</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">assert</span> <span class="n">islandOffCenter</span> <span class="o">&gt;</span> <span class="n">islandDiam</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">islandOffCenter</span><span class="o">+</span><span class="n">islandDiam</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">radius</span>
    <span class="k">assert</span> <span class="n">horizon</span> <span class="o">&gt;=</span> <span class="mf">0.</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerLength</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">horizon</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">+=</span> <span class="n">circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">radius</span><span class="o">+</span><span class="n">horizon</span><span class="p">,</span> <span class="n">num_points_per_unit_len</span><span class="o">=</span><span class="n">numPointsPerLength</span><span class="p">)</span>
    <span class="n">island</span> <span class="o">=</span> <span class="n">rectangle</span><span class="p">((</span><span class="o">-</span><span class="n">islandDiam</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">islandDiam</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">islandDiam</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">islandDiam</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="p">(</span><span class="n">island</span><span class="o">+</span><span class="p">(</span><span class="n">islandOffCenter</span><span class="p">,</span> <span class="n">islandOffCenter</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="p">(</span><span class="n">island</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">islandOffCenter</span><span class="p">,</span> <span class="n">islandOffCenter</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="p">(</span><span class="n">island</span><span class="o">+</span><span class="p">(</span><span class="n">islandOffCenter</span><span class="p">,</span> <span class="o">-</span><span class="n">islandOffCenter</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="p">(</span><span class="n">island</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">islandOffCenter</span><span class="p">,</span> <span class="o">-</span><span class="n">islandOffCenter</span><span class="p">))</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">min_angle</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="simpleBox"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.simpleBox">[docs]</a><span class="k">def</span> <span class="nf">simpleBox</span><span class="p">():</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh3d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>


<div class="viewcode-block" id="gradedBox"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.gradedBox">[docs]</a><span class="k">def</span> <span class="nf">gradedBox</span><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshCy</span> <span class="kn">import</span> <span class="nn">gradedHypercubeTransformer</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">simpleBox</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setMeshTransformation</span><span class="p">(</span><span class="n">gradedHypercubeTransformer</span><span class="p">(</span><span class="n">factor</span><span class="p">))</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">refine</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="standardSimplex"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.standardSimplex">[docs]</a><span class="k">def</span> <span class="nf">standardSimplex</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh1d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh3d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>


<div class="viewcode-block" id="standardSimplex2D"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.standardSimplex2D">[docs]</a><span class="k">def</span> <span class="nf">standardSimplex2D</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">standardSimplex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="standardSimplex3D"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.standardSimplex3D">[docs]</a><span class="k">def</span> <span class="nf">standardSimplex3D</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">standardSimplex</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="simpleFicheraCube"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.simpleFicheraCube">[docs]</a><span class="k">def</span> <span class="nf">simpleFicheraCube</span><span class="p">():</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="c1">#</span>
                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="c1">#</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="c1">#</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">boxCells</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>

    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">boxCells</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                       <span class="n">boxCells</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                       <span class="n">boxCells</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
                       <span class="n">boxCells</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span>
                       <span class="n">boxCells</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                       <span class="n">boxCells</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
                       <span class="n">boxCells</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">mesh3d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>


<div class="viewcode-block" id="simpleLshape"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.simpleLshape">[docs]</a><span class="k">def</span> <span class="nf">simpleLshape</span><span class="p">():</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># 0</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># 1</span>
                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># 2</span>
                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># 3</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># 4</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># 5</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># 6</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>  <span class="c1"># 7</span>

    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>


<div class="viewcode-block" id="disconnectedDomain"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.disconnectedDomain">[docs]</a><span class="k">def</span> <span class="nf">disconnectedDomain</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">sep</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">sep</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">sep</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">sep</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>

    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>


<div class="viewcode-block" id="Lshape"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.Lshape">[docs]</a><span class="k">def</span> <span class="nf">Lshape</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">mshr</span> <span class="kn">import</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">generate_mesh</span>
    <span class="kn">from</span> <span class="nn">dolfin</span> <span class="kn">import</span> <span class="n">Point</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
              <span class="o">-</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">generate_mesh</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()]</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cells</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>


<div class="viewcode-block" id="circle"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.circle">[docs]</a><span class="k">def</span> <span class="nf">circle</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">returnFacets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">meshpy.triangle</span> <span class="kn">import</span> <span class="n">MeshInfo</span><span class="p">,</span> <span class="n">build</span>
    <span class="n">mesh_info</span> <span class="o">=</span> <span class="n">MeshInfo</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;min_angle&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;min_angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">),</span> <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_facets</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="n">mesh_meshpy</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="c1"># Make sure that one node is on the origin.</span>
    <span class="c1"># Otherwise the radialMeshTransformation does weird stuff</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">resetMeshInfo</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">mesh</span><span class="o">.</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">10.</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshCy</span> <span class="kn">import</span> <span class="nn">radialMeshTransformer</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setMeshTransformation</span><span class="p">(</span><span class="n">radialMeshTransformer</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">returnFacets</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="circleWithInnerRadius"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.circleWithInnerRadius">[docs]</a><span class="k">def</span> <span class="nf">circleWithInnerRadius</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">innerRadius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">returnFacets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">meshpy.triangle</span> <span class="kn">import</span> <span class="n">MeshInfo</span><span class="p">,</span> <span class="n">build</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">mesh2d</span>
    <span class="n">mesh_info</span> <span class="o">=</span> <span class="n">MeshInfo</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;min_angle&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;min_angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">),</span>
                       <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">nInner</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">innerRadius</span><span class="o">/</span><span class="n">radius</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nInner</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">innerRadius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">nInner</span><span class="p">),</span>
                       <span class="n">innerRadius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">nInner</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nInner</span><span class="p">):</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">))</span>
    <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">nInner</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_facets</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="n">mesh_meshpy</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="c1"># Make sure that one node is on the origin.</span>
    <span class="c1"># Otherwise the radialMeshTransformation does weird stuff</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">resetMeshInfo</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">mesh</span><span class="o">.</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">10.</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshCy</span> <span class="kn">import</span> <span class="nn">radialMeshTransformer</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setMeshTransformation</span><span class="p">(</span><span class="n">radialMeshTransformer</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">returnFacets</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="gradedIntervals"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.gradedIntervals">[docs]</a><span class="k">def</span> <span class="nf">gradedIntervals</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="n">numIntervals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span>

    <span class="n">intervals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="nb">int</span><span class="p">:</span> <span class="nb">int</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="n">intervalSizes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">intNo</span><span class="p">,</span> <span class="n">interval</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
        <span class="n">mu1</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mu1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mu2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="n">radius</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">mu2</span><span class="p">)))),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mu2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="n">radius</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">mu1</span><span class="p">)))),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">Ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">Ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="n">radius</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">mu1</span><span class="p">)))),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">Ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="n">radius</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">mu2</span><span class="p">)))),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Ms</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">intNo</span><span class="p">,</span> <span class="n">interval</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
        <span class="n">mu1</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">M1</span> <span class="o">=</span> <span class="n">Ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="p">]</span>
        <span class="n">M2</span> <span class="o">=</span> <span class="n">Ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">M1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">M2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">center</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">M1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">indexCenter</span> <span class="o">=</span> <span class="n">Ms</span><span class="p">[:</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">points</span><span class="p">[</span><span class="n">indexCenter</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">center</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">Ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">points</span><span class="p">[</span><span class="n">indexCenter</span><span class="o">-</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">center</span> <span class="o">-</span> <span class="n">radius</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span><span class="o">/</span><span class="n">M</span><span class="p">)</span><span class="o">**</span><span class="n">mu1</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">Ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">intNo</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">points</span><span class="p">[</span><span class="n">indexCenter</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">center</span> <span class="o">+</span> <span class="n">radius</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span><span class="o">/</span><span class="n">M</span><span class="p">)</span><span class="o">**</span><span class="n">mu2</span><span class="p">)</span>

    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Ms</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">cells</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ms</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">cells</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ms</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh1d</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshCy</span> <span class="kn">import</span> <span class="nn">multiIntervalMeshTransformer</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setMeshTransformation</span><span class="p">(</span><span class="n">multiIntervalMeshTransformer</span><span class="p">(</span><span class="n">intervals</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="graded_interval"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.graded_interval">[docs]</a><span class="k">def</span> <span class="nf">graded_interval</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mu2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mu2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">mu</span>
    <span class="n">intervals</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">gradedIntervals</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span></div>


<div class="viewcode-block" id="double_graded_interval"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.double_graded_interval">[docs]</a><span class="k">def</span> <span class="nf">double_graded_interval</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">mu_ll</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mu_rr</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mu_lr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mu_rl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mu_lr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mu_lr</span> <span class="o">=</span> <span class="n">mu_ll</span>
    <span class="k">if</span> <span class="n">mu_rl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mu_rl</span> <span class="o">=</span> <span class="n">mu_rr</span>
    <span class="n">intervals</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">mu_ll</span><span class="p">,</span> <span class="n">mu_lr</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">mu_rl</span><span class="p">,</span> <span class="n">mu_rr</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">gradedIntervals</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span></div>


<div class="viewcode-block" id="double_graded_interval_with_interaction"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.double_graded_interval_with_interaction">[docs]</a><span class="k">def</span> <span class="nf">double_graded_interval_with_interaction</span><span class="p">(</span><span class="n">horizon</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mu_ll</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mu_rr</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mu_lr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mu_rl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">horizon</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">horizon</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mu_lr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mu_lr</span> <span class="o">=</span> <span class="n">mu_ll</span>
    <span class="k">if</span> <span class="n">mu_rl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mu_rl</span> <span class="o">=</span> <span class="n">mu_rr</span>
    <span class="n">intervals</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="o">-</span><span class="n">horizon</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mu_ll</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">mu_ll</span><span class="p">,</span> <span class="n">mu_lr</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">mu_rl</span><span class="p">,</span> <span class="n">mu_rr</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="n">horizon</span><span class="p">,</span> <span class="n">mu_rr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">gradedIntervals</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span></div>


<div class="viewcode-block" id="graded_circle"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.graded_circle">[docs]</a><span class="k">def</span> <span class="nf">graded_circle</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">returnFacets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">meshpy.triangle</span> <span class="kn">import</span> <span class="n">MeshInfo</span><span class="p">,</span> <span class="n">build</span>
    <span class="n">mesh_info</span> <span class="o">=</span> <span class="n">MeshInfo</span><span class="p">()</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">rold</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">rj</span> <span class="o">=</span> <span class="n">radius</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span><span class="o">/</span><span class="n">M</span><span class="p">)</span><span class="o">**</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">hj</span> <span class="o">=</span> <span class="n">rj</span><span class="o">-</span><span class="n">rold</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">rj</span><span class="o">/</span><span class="n">hj</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rj</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">),</span> <span class="n">rj</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">)))</span>
        <span class="n">rold</span> <span class="o">=</span> <span class="n">rj</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)):</span>
            <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="p">))</span>

    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_facets</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="n">mesh_meshpy</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">returnFacets</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="double_graded_circle"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.double_graded_circle">[docs]</a><span class="k">def</span> <span class="nf">double_graded_circle</span><span class="p">(</span><span class="n">M</span><span class="p">,</span>
                         <span class="n">muInterior</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">muExterior</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                         <span class="n">rInterior</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">rExterior</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                         <span class="n">returnFacets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">meshpy.triangle</span> <span class="kn">import</span> <span class="n">MeshInfo</span><span class="p">,</span> <span class="n">build</span>
    <span class="n">mesh_info</span> <span class="o">=</span> <span class="n">MeshInfo</span><span class="p">()</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">rold</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">rj</span> <span class="o">=</span> <span class="n">rInterior</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span><span class="o">/</span><span class="n">M</span><span class="p">)</span><span class="o">**</span><span class="n">muInterior</span><span class="p">)</span>
        <span class="c1"># print(rj)</span>
        <span class="n">hj</span> <span class="o">=</span> <span class="n">rj</span><span class="o">-</span><span class="n">rold</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">rj</span><span class="o">/</span><span class="n">hj</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rj</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">),</span> <span class="n">rj</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">)))</span>
        <span class="n">rold</span> <span class="o">=</span> <span class="n">rj</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)):</span>
            <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="p">))</span>

    <span class="c1"># rold = rInterior</span>
    <span class="c1"># M = int(((rExterior-rInterior)/rInterior)*M)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">rj</span> <span class="o">=</span> <span class="n">rInterior</span> <span class="o">+</span> <span class="p">(</span><span class="n">rExterior</span><span class="o">-</span><span class="n">rInterior</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">/</span><span class="n">M</span><span class="p">)</span><span class="o">**</span><span class="n">muExterior</span>
        <span class="c1"># print(rj)</span>
        <span class="n">hj</span> <span class="o">=</span> <span class="n">rj</span><span class="o">-</span><span class="n">rold</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">rj</span><span class="o">/</span><span class="n">hj</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rj</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">),</span> <span class="n">rj</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">)))</span>
        <span class="n">rold</span> <span class="o">=</span> <span class="n">rj</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)):</span>
            <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="p">))</span>

    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_facets</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="n">mesh_meshpy</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">returnFacets</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="cutoutCircle"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.cutoutCircle">[docs]</a><span class="k">def</span> <span class="nf">cutoutCircle</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">cutoutAngle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>
                 <span class="n">returnFacets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">minAngle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">meshpy.triangle</span> <span class="kn">import</span> <span class="n">MeshInfo</span><span class="p">,</span> <span class="n">build</span>
    <span class="n">mesh_info</span> <span class="o">=</span> <span class="n">MeshInfo</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)]</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">cutoutAngle</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">),</span>
                       <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">cutoutAngle</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_facets</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="n">mesh_meshpy</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">,</span> <span class="n">min_angle</span><span class="o">=</span><span class="n">minAngle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">returnFacets</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="twinCircle"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.twinCircle">[docs]</a><span class="k">def</span> <span class="nf">twinCircle</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">circle</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">))</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cells</span><span class="p">))</span>
    <span class="n">vertices</span><span class="p">[:</span><span class="n">mesh</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">radius</span><span class="o">+</span><span class="n">sep</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">vertices</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">radius</span><span class="o">+</span><span class="n">sep</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">cells</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">num_cells</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">+=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">num_vertices</span>
    <span class="k">return</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>


<div class="viewcode-block" id="dumbbell"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.dumbbell">[docs]</a><span class="k">def</span> <span class="nf">dumbbell</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">barAngle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">barLength</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
             <span class="n">returnFacets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">minAngle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">meshpy.triangle</span> <span class="kn">import</span> <span class="n">MeshInfo</span><span class="p">,</span> <span class="n">build</span>
    <span class="n">mesh_info</span> <span class="o">=</span> <span class="n">MeshInfo</span><span class="p">()</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">barLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span>
                       <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">barAngle</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">barAngle</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
                       <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">barAngle</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">barAngle</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">barLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span>
                       <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="n">barAngle</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">barAngle</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
                       <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="n">barAngle</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">barAngle</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">):</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_facets</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="n">mesh_meshpy</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">,</span> <span class="n">min_angle</span><span class="o">=</span><span class="n">minAngle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">returnFacets</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="wrench"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.wrench">[docs]</a><span class="k">def</span> <span class="nf">wrench</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.17</span><span class="p">,</span> <span class="n">radius2</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">barLength</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">returnFacets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">minAngle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">meshpy.triangle</span> <span class="kn">import</span> <span class="n">MeshInfo</span><span class="p">,</span> <span class="n">build</span>
    <span class="n">mesh_info</span> <span class="o">=</span> <span class="n">MeshInfo</span><span class="p">()</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">barLength</span> <span class="o">+</span>
                       <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">),</span>
                       <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">radius2</span> <span class="o">+</span>
                       <span class="n">radius2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">),</span>
                       <span class="n">radius</span><span class="o">+</span><span class="n">radius2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">)))</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">1.5</span><span class="o">*</span><span class="n">radius2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">radius2</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">radius2</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="o">-</span><span class="n">th</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="n">n</span><span class="p">),</span>
                       <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="o">-</span><span class="n">th</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="n">n</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)):</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_facets</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="n">mesh_meshpy</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">,</span> <span class="n">min_angle</span><span class="o">=</span><span class="n">minAngle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">returnFacets</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="rectangle"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.rectangle">[docs]</a><span class="k">def</span> <span class="nf">rectangle</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">bx</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">ay</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshConstruction</span> <span class="kn">import</span> <span class="nn">rectangle</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">rectangle</span><span class="p">((</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">),</span> <span class="n">num_points</span><span class="o">=</span><span class="p">[</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="Hshape"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.Hshape">[docs]</a><span class="k">def</span> <span class="nf">Hshape</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">returnFacets</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">meshpy.triangle</span> <span class="kn">import</span> <span class="n">MeshInfo</span><span class="p">,</span> <span class="n">build</span>
    <span class="n">mesh_info</span> <span class="o">=</span> <span class="n">MeshInfo</span><span class="p">()</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
              <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="n">h</span><span class="p">),</span>
              <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">h</span><span class="p">)]</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)):</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_facets</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="n">mesh_meshpy</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">,</span> <span class="n">min_angle</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">returnFacets</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="ball2"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.ball2">[docs]</a><span class="k">def</span> <span class="nf">ball2</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">meshpy.tet</span> <span class="kn">import</span> <span class="n">MeshInfo</span><span class="p">,</span> <span class="n">build</span>
    <span class="n">mesh_info</span> <span class="o">=</span> <span class="n">MeshInfo</span><span class="p">()</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">radius</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">radius</span><span class="p">)]</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
              <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>

    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">mesh_info</span><span class="o">.</span><span class="n">set_facets</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="n">mesh_meshpy</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh3d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="ball"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.ball">[docs]</a><span class="k">def</span> <span class="nf">ball</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">radial_subdiv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build mesh for 3D ball as surface of revolution.</span>
<span class="sd">    points         determines the number of points on the curve.</span>
<span class="sd">    radial_subdiv  determines the number of steps in the rotation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">meshpy.tet</span> <span class="kn">import</span> <span class="n">MeshInfo</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">Options</span>
    <span class="kn">from</span> <span class="nn">meshpy.geometry</span> <span class="kn">import</span> <span class="n">generate_surface_of_revolution</span><span class="p">,</span> <span class="n">EXT_OPEN</span><span class="p">,</span> <span class="n">GeometryBuilder</span>
    <span class="kn">from</span> <span class="nn">meshpy.geometry</span> <span class="kn">import</span> <span class="n">make_ball</span>

    <span class="k">if</span> <span class="n">radial_subdiv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">radial_subdiv</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">points</span><span class="o">+</span><span class="mi">2</span>

    <span class="n">dphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">points</span>

    <span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">r</span>

    <span class="n">rz</span> <span class="o">=</span> <span class="p">[(</span><span class="n">truncate</span><span class="p">(</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dphi</span><span class="p">)),</span> <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dphi</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">points</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

    <span class="n">geob</span> <span class="o">=</span> <span class="n">GeometryBuilder</span><span class="p">()</span>
    <span class="n">geob</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="o">*</span><span class="n">generate_surface_of_revolution</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span>
                                                      <span class="n">closure</span><span class="o">=</span><span class="n">EXT_OPEN</span><span class="p">,</span>
                                                      <span class="n">radial_subdiv</span><span class="o">=</span><span class="n">radial_subdiv</span><span class="p">))</span>
    <span class="c1"># geob.add_geometry(*make_ball(radius, radial_subdiv))</span>
    <span class="n">mesh_info</span> <span class="o">=</span> <span class="n">MeshInfo</span><span class="p">()</span>
    <span class="n">geob</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">)</span>
    <span class="n">mesh_meshpy</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">mesh_info</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># , options=Options(switches=&#39;pq1.2/10&#39;)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh3d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_meshpy</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="ballNd"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.ballNd">[docs]</a><span class="k">def</span> <span class="nf">ballNd</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">simpleInterval</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">mesh</span><span class="o">.</span><span class="n">h</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">:</span>
            <span class="n">mesh</span><span class="p">,</span> <span class="n">lookup</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="n">returnLookup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">radialMeshTransformation</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">lookup</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mesh</span>
    <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">circle</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">radius</span><span class="o">/</span><span class="n">h</span><span class="p">)),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">max_volume</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">ball</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">mesh</span><span class="o">.</span><span class="n">h</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">:</span>
            <span class="n">mesh</span><span class="p">,</span> <span class="n">lookup</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="n">returnLookup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">radialMeshTransformation</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">lookup</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mesh</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>


<div class="viewcode-block" id="gradeMesh"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.gradeMesh">[docs]</a><span class="k">def</span> <span class="nf">gradeMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">grading</span><span class="p">):</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices_as_array</span>
    <span class="n">norms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">norms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="n">grading</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">resetMeshInfo</span><span class="p">()</span></div>


<div class="viewcode-block" id="gradeUniformBall"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.gradeUniformBall">[docs]</a><span class="k">def</span> <span class="nf">gradeUniformBall</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span>
                     <span class="n">muInterior</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">muExterior</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                     <span class="n">rInterior</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">rExterior</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rExteriorInitial</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">rExteriorInitial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rExteriorInitial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">rInterior</span> <span class="o">&lt;</span> <span class="n">rExteriorInitial</span>
    <span class="k">if</span> <span class="n">rExterior</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rExterior</span> <span class="o">=</span> <span class="n">rExteriorInitial</span>

    <span class="k">def</span> <span class="nf">grading</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">rInterior</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rInterior</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="o">/</span><span class="n">rInterior</span><span class="p">)</span><span class="o">**</span><span class="n">muInterior</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rInterior</span> <span class="o">+</span> <span class="p">(</span><span class="n">rExterior</span><span class="o">-</span><span class="n">rInterior</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">r</span><span class="o">-</span><span class="n">rInterior</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rExteriorInitial</span><span class="o">-</span><span class="n">rInterior</span><span class="p">))</span><span class="o">**</span><span class="n">muExterior</span>

    <span class="n">gradeMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">grading</span><span class="p">)</span></div>


<div class="viewcode-block" id="meshNd"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd">[docs]</a><span class="k">class</span> <span class="nc">meshNd</span><span class="p">(</span><span class="n">meshBase</span><span class="p">):</span>
<div class="viewcode-block" id="meshNd.__init__"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">meshNd</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryVertices&#39;</span><span class="p">):</span>
            <span class="n">boundaryVertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span>
            <span class="n">boundaryVertexTags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boundaryVertices</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">boundaryVertexTags</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryEdges&#39;</span><span class="p">):</span>
            <span class="n">boundaryEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span>
            <span class="n">boundaryEdgeTags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boundaryEdges</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">boundaryEdgeTags</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryFaces&#39;</span><span class="p">):</span>
            <span class="n">boundaryFaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span>
            <span class="n">boundaryFaceTags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaceTags</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boundaryFaces</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">boundaryFaceTags</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">meshNd</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">(),</span>
                <span class="n">boundaryVertices</span><span class="p">,</span> <span class="n">boundaryVertexTags</span><span class="p">,</span>
                <span class="n">boundaryEdges</span><span class="p">,</span> <span class="n">boundaryEdgeTags</span><span class="p">,</span>
                <span class="n">boundaryFaces</span><span class="p">,</span> <span class="n">boundaryFaceTags</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">meshNd</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertices</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertexTags</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdgeTags</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaces</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaceTags</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

<div class="viewcode-block" id="meshNd.get_boundary_vertices"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_boundary_vertices">[docs]</a>    <span class="k">def</span> <span class="nf">get_boundary_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryVertices&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">manifold_dim</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertices</span> <span class="o">=</span> <span class="n">boundaryVerticesFromBoundaryEdges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertices</span> <span class="o">=</span> <span class="n">boundaryVertices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertices</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertices</span></div>

<div class="viewcode-block" id="meshNd.set_boundary_vertices"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.set_boundary_vertices">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertices</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="n">boundaryVertices</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">get_boundary_vertices</span><span class="p">,</span>
                                <span class="n">fset</span><span class="o">=</span><span class="n">set_boundary_vertices</span><span class="p">)</span>

<div class="viewcode-block" id="meshNd.get_boundary_edges"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_boundary_edges">[docs]</a>    <span class="k">def</span> <span class="nf">get_boundary_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryEdges&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">manifold_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">manifold_dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span> <span class="o">=</span> <span class="n">boundaryEdges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">manifold_dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span> <span class="o">=</span> <span class="n">boundaryEdgesFromBoundaryFaces</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span></div>

<div class="viewcode-block" id="meshNd.set_boundary_edges"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.set_boundary_edges">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">assert</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">INDEX</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="n">boundaryEdges</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">get_boundary_edges</span><span class="p">,</span>
                             <span class="n">fset</span><span class="o">=</span><span class="n">set_boundary_edges</span><span class="p">)</span>

<div class="viewcode-block" id="meshNd.get_boundary_faces"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_boundary_faces">[docs]</a>    <span class="k">def</span> <span class="nf">get_boundary_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryFaces&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaces</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaces</span> <span class="o">=</span> <span class="n">boundaryFaces</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaces</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaces</span></div>

<div class="viewcode-block" id="meshNd.set_boundary_faces"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.set_boundary_faces">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaces</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="n">boundaryFaces</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">get_boundary_faces</span><span class="p">,</span>
                             <span class="n">fset</span><span class="o">=</span><span class="n">set_boundary_faces</span><span class="p">)</span>

<div class="viewcode-block" id="meshNd.get_boundary_cells"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_boundary_cells">[docs]</a>    <span class="k">def</span> <span class="nf">get_boundary_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryCells&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">manifold_dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryCells</span> <span class="o">=</span> <span class="n">boundaryEdges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span> <span class="n">returnBoundaryCells</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryCells</span></div>

<div class="viewcode-block" id="meshNd.set_boundary_cells"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.set_boundary_cells">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryCells</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="n">boundaryCells</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">get_boundary_cells</span><span class="p">,</span>
                             <span class="n">fset</span><span class="o">=</span><span class="n">set_boundary_cells</span><span class="p">)</span>

<div class="viewcode-block" id="meshNd.get_interiorVertices"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_interiorVertices">[docs]</a>    <span class="k">def</span> <span class="nf">get_interiorVertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_interiorVertices&#39;</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
            <span class="n">temp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_interiorVertices</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interiorVertices</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interiorVertices</span></div>

<div class="viewcode-block" id="meshNd.getInteriorVerticesByTag"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.getInteriorVerticesByTag">[docs]</a>    <span class="k">def</span> <span class="nf">getInteriorVerticesByTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">NO_BOUNDARY</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBoundaryVerticesByTag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">bv</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">idx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">INDEX</span><span class="p">)</span></div>

<div class="viewcode-block" id="meshNd.get_diam"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_diam">[docs]</a>    <span class="k">def</span> <span class="nf">get_diam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span>
        <span class="k">return</span> <span class="n">norm</span><span class="p">(</span><span class="n">vertices</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">vertices</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span></div>

    <span class="n">interiorVertices</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">get_interiorVertices</span><span class="p">)</span>
    <span class="n">diam</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">get_diam</span><span class="p">)</span>

<div class="viewcode-block" id="meshNd.copy"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">newMesh</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">meshNd</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryVertices&#39;</span><span class="p">):</span>
            <span class="n">newMesh</span><span class="o">.</span><span class="n">_boundaryVertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryVertexTags&#39;</span><span class="p">):</span>
            <span class="n">newMesh</span><span class="o">.</span><span class="n">_boundaryVertexTags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertexTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryEdges&#39;</span><span class="p">):</span>
            <span class="n">newMesh</span><span class="o">.</span><span class="n">_boundaryEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryEdgeTags&#39;</span><span class="p">):</span>
            <span class="n">newMesh</span><span class="o">.</span><span class="n">_boundaryEdgeTags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdgeTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryFaces&#39;</span><span class="p">):</span>
            <span class="n">newMesh</span><span class="o">.</span><span class="n">_boundaryFaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaces</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryFaceTags&#39;</span><span class="p">):</span>
            <span class="n">newMesh</span><span class="o">.</span><span class="n">_boundaryFaceTags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaceTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">newMesh</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> with </span><span class="si">{:,}</span><span class="s1"> vertices &#39;</span>
                <span class="o">+</span> <span class="s1">&#39;and </span><span class="si">{:,}</span><span class="s1"> cells&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">)</span>

<div class="viewcode-block" id="meshNd.get_boundary_vertex_tags"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_boundary_vertex_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_boundary_vertex_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryVertexTags&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertexTags</span> <span class="o">=</span> <span class="n">PHYSICAL</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                                         <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertexTags</span></div>

<div class="viewcode-block" id="meshNd.set_boundary_vertex_tags"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.set_boundary_vertex_tags">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_vertex_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">TAG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertexTags</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="n">boundaryVertexTags</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fset</span><span class="o">=</span><span class="n">set_boundary_vertex_tags</span><span class="p">,</span>
                                  <span class="n">fget</span><span class="o">=</span><span class="n">get_boundary_vertex_tags</span><span class="p">)</span>

<div class="viewcode-block" id="meshNd.tagBoundaryVertices"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.tagBoundaryVertices">[docs]</a>    <span class="k">def</span> <span class="nf">tagBoundaryVertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagFunc</span><span class="p">):</span>
        <span class="n">boundaryVertexTags</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tagFunc</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span> <span class="o">=</span> <span class="n">boundaryVertexTags</span></div>

<div class="viewcode-block" id="meshNd.replaceBoundaryVertexTags"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.replaceBoundaryVertexTags">[docs]</a>    <span class="k">def</span> <span class="nf">replaceBoundaryVertexTags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagFunc</span><span class="p">,</span> <span class="n">tagsToReplace</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
        <span class="n">boundaryVertexTags</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">tagsToReplace</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tagFunc</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span> <span class="o">=</span> <span class="n">boundaryVertexTags</span></div>

<div class="viewcode-block" id="meshNd.getBoundaryVerticesByTag"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.getBoundaryVerticesByTag">[docs]</a>    <span class="k">def</span> <span class="nf">getBoundaryVerticesByTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span> <span class="o">==</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span> <span class="o">==</span> <span class="n">t</span><span class="p">))</span>
            <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span> <span class="o">==</span> <span class="n">tag</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">sorted</span><span class="p">:</span>
            <span class="n">bv</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">bv</span></div>

<div class="viewcode-block" id="meshNd.get_boundary_edge_tags"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_boundary_edge_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_boundary_edge_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryEdgeTags&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdgeTags</span> <span class="o">=</span> <span class="n">PHYSICAL</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                      <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdgeTags</span></div>

<div class="viewcode-block" id="meshNd.set_boundary_edge_tags"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.set_boundary_edge_tags">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_edge_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdgeTags</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="n">boundaryEdgeTags</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fset</span><span class="o">=</span><span class="n">set_boundary_edge_tags</span><span class="p">,</span>
                                <span class="n">fget</span><span class="o">=</span><span class="n">get_boundary_edge_tags</span><span class="p">)</span>

<div class="viewcode-block" id="meshNd.tagBoundaryEdges"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.tagBoundaryEdges">[docs]</a>    <span class="k">def</span> <span class="nf">tagBoundaryEdges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagFunc</span><span class="p">):</span>
        <span class="n">boundaryEdgeTags</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tagFunc</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span> <span class="o">=</span> <span class="n">boundaryEdgeTags</span></div>

<div class="viewcode-block" id="meshNd.replaceBoundaryEdgeTags"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.replaceBoundaryEdgeTags">[docs]</a>    <span class="k">def</span> <span class="nf">replaceBoundaryEdgeTags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagFunc</span><span class="p">,</span> <span class="n">tagsToReplace</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
        <span class="n">boundaryEdgeTags</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">tagsToReplace</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tagFunc</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span> <span class="o">=</span> <span class="n">boundaryEdgeTags</span></div>

<div class="viewcode-block" id="meshNd.getBoundaryEdgesByTag"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.getBoundaryEdgesByTag">[docs]</a>    <span class="k">def</span> <span class="nf">getBoundaryEdgesByTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">returnBoundaryCells</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">returnBoundaryCells</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryCells</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span> <span class="o">==</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span> <span class="o">==</span> <span class="n">t</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">returnBoundaryCells</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryCells</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>

<div class="viewcode-block" id="meshNd.get_boundary_face_tags"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_boundary_face_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_boundary_face_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryFaceTags&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaceTags</span> <span class="o">=</span> <span class="n">PHYSICAL</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                      <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaceTags</span></div>

<div class="viewcode-block" id="meshNd.set_boundary_face_tags"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.set_boundary_face_tags">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_face_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryFaceTags</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="n">boundaryFaceTags</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fset</span><span class="o">=</span><span class="n">set_boundary_face_tags</span><span class="p">,</span>
                                <span class="n">fget</span><span class="o">=</span><span class="n">get_boundary_face_tags</span><span class="p">)</span>

<div class="viewcode-block" id="meshNd.tagBoundaryFaces"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.tagBoundaryFaces">[docs]</a>    <span class="k">def</span> <span class="nf">tagBoundaryFaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagFunc</span><span class="p">):</span>
        <span class="n">boundaryFaceTags</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="n">boundaryFaceTags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tagFunc</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaceTags</span> <span class="o">=</span> <span class="n">boundaryFaceTags</span></div>

<div class="viewcode-block" id="meshNd.getBoundaryFacesByTag"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.getBoundaryFacesByTag">[docs]</a>    <span class="k">def</span> <span class="nf">getBoundaryFacesByTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaceTags</span> <span class="o">==</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaceTags</span> <span class="o">==</span> <span class="n">t</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaceTags</span> <span class="o">==</span> <span class="n">tag</span><span class="p">]</span></div>

<div class="viewcode-block" id="meshNd.HDF5write"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.HDF5write">[docs]</a>    <span class="k">def</span> <span class="nf">HDF5write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">COMPRESSION</span> <span class="o">=</span> <span class="s1">&#39;gzip&#39;</span>
        <span class="n">node</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span>
                            <span class="n">compression</span><span class="o">=</span><span class="n">COMPRESSION</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span>
                            <span class="n">compression</span><span class="o">=</span><span class="n">COMPRESSION</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryVertices&#39;</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;boundaryVertices&#39;</span><span class="p">,</span>
                                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">,</span>
                                <span class="n">compression</span><span class="o">=</span><span class="n">COMPRESSION</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryVertexTags&#39;</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;boundaryVertexTags&#39;</span><span class="p">,</span>
                                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">,</span>
                                <span class="n">compression</span><span class="o">=</span><span class="n">COMPRESSION</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryEdges&#39;</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;boundaryEdges&#39;</span><span class="p">,</span>
                                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">,</span>
                                <span class="n">compression</span><span class="o">=</span><span class="n">COMPRESSION</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryEdgeTags&#39;</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;boundaryEdgeTags&#39;</span><span class="p">,</span>
                                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">,</span>
                                <span class="n">compression</span><span class="o">=</span><span class="n">COMPRESSION</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryFaces&#39;</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;boundaryFaces&#39;</span><span class="p">,</span>
                                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="p">,</span>
                                <span class="n">compression</span><span class="o">=</span><span class="n">COMPRESSION</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryFaceTags&#39;</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;boundaryFaceTags&#39;</span><span class="p">,</span>
                                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaceTags</span><span class="p">,</span>
                                <span class="n">compression</span><span class="o">=</span><span class="n">COMPRESSION</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span></div>

<div class="viewcode-block" id="meshNd.HDF5read"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.HDF5read">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">HDF5read</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;vertices&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh1d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh3d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boundaryVertices&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">boundaryVertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;boundaryVertices&#39;</span><span class="p">],</span>
                                             <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boundaryVertexTags&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">boundaryVertexTags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;boundaryVertexTags&#39;</span><span class="p">],</span>
                                               <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boundaryEdges&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">boundaryEdges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;boundaryEdges&#39;</span><span class="p">],</span>
                                          <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boundaryEdgeTags&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">boundaryEdgeTags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;boundaryEdgeTags&#39;</span><span class="p">],</span>
                                             <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boundaryFaces&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">boundaryFaces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;boundaryFaces&#39;</span><span class="p">],</span>
                                          <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boundaryFaceTags&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">boundaryFaceTags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;boundaryFaceTags&#39;</span><span class="p">],</span>
                                             <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mesh</span></div>

<div class="viewcode-block" id="meshNd.exportVTK"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.exportVTK">[docs]</a>    <span class="k">def</span> <span class="nf">exportVTK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">cell_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">meshio</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;line&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;triangle&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;tetra&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
        <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">3</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span>
        <span class="n">meshio</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                     <span class="n">meshio</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span>
                                 <span class="p">{</span><span class="n">cell_type</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells_as_array</span><span class="p">},</span>
                                 <span class="n">cell_data</span><span class="o">=</span><span class="n">cell_data</span><span class="p">),</span>
                     <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;vtk&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="meshNd.exportSolutionVTK"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.exportSolutionVTK">[docs]</a>    <span class="k">def</span> <span class="nf">exportSolutionVTK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="s1">&#39;solution&#39;</span><span class="p">,</span> <span class="n">cell_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">meshio</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">]</span>
        <span class="n">sols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">sol</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">linearPart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">)</span>
            <span class="n">v2d</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
            <span class="n">DoFMap</span><span class="o">.</span><span class="n">getVertexDoFs</span><span class="p">(</span><span class="n">v2d</span><span class="p">)</span>
            <span class="n">sol2</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">):</span>
                <span class="n">sol2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="n">v2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
            <span class="n">sols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;line&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;triangle&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;tetra&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
        <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">3</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span>
        <span class="n">meshio</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                     <span class="n">meshio</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span>
                                 <span class="p">{</span><span class="n">cell_type</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells_as_array</span><span class="p">},</span>
                                 <span class="n">point_data</span><span class="o">=</span><span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">sol</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">sols</span><span class="p">)},</span>
                                 <span class="n">cell_data</span><span class="o">=</span><span class="n">cell_data</span><span class="p">,),</span>
                     <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;vtk&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="meshNd.readMesh"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.readMesh">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">readMesh</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">meshio</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">meshio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_format</span><span class="p">)</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">REAL</span><span class="p">)</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span>
        <span class="n">cell_type</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">meshType</span> <span class="o">=</span> <span class="n">mesh1d</span>
        <span class="k">elif</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;triangle&#39;</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">meshType</span> <span class="o">=</span> <span class="n">mesh2d</span>
        <span class="k">elif</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;tetra&#39;</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">meshType</span> <span class="o">=</span> <span class="n">mesh3d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span> <span class="p">:</span><span class="n">dim</span><span class="p">])</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">meshType</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span></div>

<div class="viewcode-block" id="meshNd.getPartitions"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.getPartitions">[docs]</a>    <span class="k">def</span> <span class="nf">getPartitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numPartitions</span><span class="p">,</span> <span class="n">partitioner</span><span class="o">=</span><span class="s1">&#39;metis&#39;</span><span class="p">,</span> <span class="n">partitionerParams</span><span class="o">=</span><span class="p">{}):</span>
        <span class="c1"># partition mesh cells</span>
        <span class="k">if</span> <span class="n">partitioner</span> <span class="o">==</span> <span class="s1">&#39;regular&#39;</span><span class="p">:</span>
            <span class="n">mP</span> <span class="o">=</span> <span class="n">regularMeshPartitioner</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">defaultParams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;partitionedDimensions&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">}</span>
            <span class="k">if</span> <span class="s1">&#39;regular&#39;</span> <span class="ow">in</span> <span class="n">partitionerParams</span><span class="p">:</span>
                <span class="n">defaultParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">partitionerParams</span><span class="p">[</span><span class="s1">&#39;regular&#39;</span><span class="p">])</span>
            <span class="n">part</span><span class="p">,</span> <span class="n">actualNumPartitions</span> <span class="o">=</span> <span class="n">mP</span><span class="o">.</span><span class="n">partitionCells</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">,</span>
                                                          <span class="n">partitionedDimensions</span><span class="o">=</span><span class="n">defaultParams</span><span class="p">[</span><span class="s1">&#39;partitionedDimensions&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">partitioner</span> <span class="o">==</span> <span class="s1">&#39;metis&#39;</span><span class="p">:</span>
            <span class="n">mP</span> <span class="o">=</span> <span class="n">metisMeshPartitioner</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">defaultParams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;partition_weights&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
            <span class="k">if</span> <span class="s1">&#39;metis&#39;</span> <span class="ow">in</span> <span class="n">partitionerParams</span><span class="p">:</span>
                <span class="n">defaultParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">partitionerParams</span><span class="p">[</span><span class="s1">&#39;metis&#39;</span><span class="p">])</span>
            <span class="n">part</span><span class="p">,</span> <span class="n">actualNumPartitions</span> <span class="o">=</span> <span class="n">mP</span><span class="o">.</span><span class="n">partitionCells</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">,</span>
                                                          <span class="n">partition_weights</span><span class="o">=</span><span class="n">defaultParams</span><span class="p">[</span><span class="s1">&#39;partition_weights&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">actualNumPartitions</span> <span class="o">==</span> <span class="n">numPartitions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PartitionerException</span><span class="p">(</span><span class="s1">&#39;Partitioner returned </span><span class="si">{}</span><span class="s1"> partitions instead of </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">actualNumPartitions</span><span class="p">,</span> <span class="n">numPartitions</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">part</span></div>

<div class="viewcode-block" id="meshNd.getCuthillMckeeVertexOrder"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.getCuthillMckeeVertexOrder">[docs]</a>    <span class="k">def</span> <span class="nf">getCuthillMckeeVertexOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">PyNucleus_base.linear_operators</span> <span class="kn">import</span> <span class="n">sparseGraph</span>
        <span class="kn">from</span> <span class="nn">PyNucleus_base.sparseGraph</span> <span class="kn">import</span> <span class="n">cuthill_mckee</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">P1_DoFMap</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">P1_DoFMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">buildSparsityPattern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">sparseGraph</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">indptr</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="n">dm</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="n">cuthill_mckee</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">idx</span></div>

<div class="viewcode-block" id="meshNd.global_h"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.global_h">[docs]</a>    <span class="k">def</span> <span class="nf">global_h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
        <span class="k">if</span> <span class="n">comm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">h</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">MAX</span><span class="p">)</span></div>

<div class="viewcode-block" id="meshNd.global_hmin"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.global_hmin">[docs]</a>    <span class="k">def</span> <span class="nf">global_hmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
        <span class="n">hmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hmin</span>
        <span class="k">if</span> <span class="n">comm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">hmin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">MIN</span><span class="p">)</span></div>

<div class="viewcode-block" id="meshNd.global_volume"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.global_volume">[docs]</a>    <span class="k">def</span> <span class="nf">global_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume</span>
        <span class="k">if</span> <span class="n">comm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">vol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">SUM</span><span class="p">)</span></div>

<div class="viewcode-block" id="meshNd.global_diam"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.global_diam">[docs]</a>    <span class="k">def</span> <span class="nf">global_diam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">comm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">diam</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">comm</span><span class="o">.</span><span class="n">Allreduce</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">MPI</span><span class="o">.</span><span class="n">IN_PLACE</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">MIN</span><span class="p">)</span>
        <span class="n">comm</span><span class="o">.</span><span class="n">Allreduce</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">MPI</span><span class="o">.</span><span class="n">IN_PLACE</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">MAX</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">norm</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="meshNd.get_surface"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_surface">[docs]</a>    <span class="k">def</span> <span class="nf">get_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_surface_mesh</span><span class="p">()</span><span class="o">.</span><span class="n">volume</span></div>

    <span class="n">surface</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">get_surface</span><span class="p">)</span>

<div class="viewcode-block" id="meshNd.get_surface_mesh"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.get_surface_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">get_surface_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">bv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBoundaryVerticesByTag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="n">cells</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">bv</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
            <span class="n">cells</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bv</span>
            <span class="n">surface</span> <span class="o">=</span> <span class="n">mesh0d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">surface</span> <span class="o">=</span> <span class="n">mesh1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBoundaryEdgesByTag</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">surface</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBoundaryFacesByTag</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="n">surface</span><span class="o">.</span><span class="n">setMeshTransformation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">surface</span></div>

<div class="viewcode-block" id="meshNd.reorderVertices"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.meshNd.reorderVertices">[docs]</a>    <span class="k">def</span> <span class="nf">reorderVertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">invidx</span> <span class="o">=</span> <span class="n">uninitialized_like</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">invidx</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryVertices&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertices</span> <span class="o">=</span> <span class="n">invidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_boundaryVertices</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryEdges&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span> <span class="o">=</span> <span class="n">invidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_boundaryFaces&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span> <span class="o">=</span> <span class="n">invidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_boundaryEdges</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="n">invidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells_as_array</span><span class="p">[:,</span> <span class="p">:]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">INDEX</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="mesh0d"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh0d">[docs]</a><span class="k">class</span> <span class="nc">mesh0d</span><span class="p">(</span><span class="n">meshNd</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="mesh1d"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d">[docs]</a><span class="k">class</span> <span class="nc">mesh1d</span><span class="p">(</span><span class="n">meshNd</span><span class="p">):</span>
<div class="viewcode-block" id="mesh1d.plot"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">lenX</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">lenX</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">lenX</span><span class="o">*</span><span class="mf">0.1</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells_as_array</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="n">c</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="n">v</span><span class="p">[</span><span class="n">c</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">]],</span>
                     <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">c</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                      <span class="n">v</span><span class="p">[</span><span class="n">c</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">]],</span>
                     <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">lenX</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">v</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">v</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">lenX</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">v</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">lenX</span><span class="o">*</span><span class="mf">0.1</span><span class="p">])</span>
            <span class="n">lenY</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">v</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">v</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">lenY</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">v</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">lenY</span><span class="o">*</span><span class="mf">0.1</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">)</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">)</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gist_rainbow&#39;</span><span class="p">)</span>
            <span class="n">num_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">tag</span><span class="p">:</span> <span class="n">cm</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">num_colors</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tags</span><span class="p">)}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">):</span>
                <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">midpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;italic&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">vno</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">vno</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                         <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">)):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span></div>

<div class="viewcode-block" id="mesh1d.plotPrepocess"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d.plotPrepocess">[docs]</a>    <span class="k">def</span> <span class="nf">plotPrepocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">DoFMaps</span> <span class="kn">import</span> <span class="nn">P0_DoFMap</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">,</span> <span class="n">P0_DoFMap</span><span class="p">):</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="o">+</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_boundary_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
            <span class="n">dof2pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_boundary_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">bDoF</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getSimplex_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">simplex</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
                    <span class="n">dof</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">simplex</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dof</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">positions</span><span class="p">[</span><span class="n">dof</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">dof2pos</span><span class="p">[</span><span class="o">-</span><span class="n">dof</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">p</span> <span class="o">=</span> <span class="n">dof2pos</span><span class="p">[</span><span class="o">-</span><span class="n">dof</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bDoF</span>
                            <span class="n">bDoF</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">positions</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="o">+</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_boundary_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
                <span class="n">xx</span><span class="p">[:</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
                <span class="n">xx</span><span class="p">[:,</span> <span class="p">:</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="o">+</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_boundary_dofs</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
            <span class="n">dof2pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_boundary_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">bDoF</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getSimplex_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">simplex</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
                    <span class="n">dof</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dof</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">positions</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">dof</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">simplex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">simplex</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">1e-9</span>
                        <span class="n">positions</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">dof</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">simplex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">simplex</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mf">1e-9</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">dof2pos</span><span class="p">[</span><span class="o">-</span><span class="n">dof</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">p</span> <span class="o">=</span> <span class="n">dof2pos</span><span class="p">[</span><span class="o">-</span><span class="n">dof</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bDoF</span>
                            <span class="n">bDoF</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">positions</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">simplex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">simplex</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">1e-9</span>
                        <span class="n">positions</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">simplex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">simplex</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mf">1e-9</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="o">+</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_boundary_dofs</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
                <span class="n">xx</span><span class="p">[:</span><span class="mi">2</span><span class="o">*</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">xx</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
                <span class="n">xx</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">xx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">)</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)))</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">positions</span><span class="p">,</span> <span class="n">xx</span></div>

<div class="viewcode-block" id="mesh1d.plotFunction"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d.plotFunction">[docs]</a>    <span class="k">def</span> <span class="nf">plotFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">DoFMap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yvals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DoFMap</span><span class="p">:</span>
            <span class="n">positions</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotPrepocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">.</span> <span class="n">DoFMaps</span> <span class="kn">import</span> <span class="nn">P0_DoFMap</span>
                <span class="n">dm</span> <span class="o">=</span> <span class="n">P0_DoFMap</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">positions</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotPrepocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">:</span>
                <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">))</span>
                <span class="n">sol</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getInteriorVerticesByTag</span><span class="p">(</span><span class="n">tag</span><span class="p">)]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">sol</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">update</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
            <span class="k">assert</span> <span class="n">yvals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">yvals</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flat</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span>
                          <span class="n">sol</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="mesh1d.plotDoFMap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d.plotDoFMap">[docs]</a>    <span class="k">def</span> <span class="nf">plotDoFMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">printDoFIndices</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="s2">&quot;Plot the DoF numbers on the mesh.&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc_context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">getDoFCoordinates</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">printDoFIndices</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">rc_context</span><span class="p">({</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}):</span>
                <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">dof</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dof</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="mesh1d.plotMeshOverlap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d.plotMeshOverlap">[docs]</a>    <span class="k">def</span> <span class="nf">plotMeshOverlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overlap</span><span class="p">):</span>
        <span class="s2">&quot;Plot a single mesh overlap.&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshOverlaps</span> <span class="kn">import</span> <span class="nn">meshOverlap</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">meshOverlap</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="c1"># self.plot(boundary=True)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">overlap</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">overlap</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">overlap</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">overlap</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="n">cellNo</span> <span class="o">=</span> <span class="n">overlap</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
            <span class="n">XY</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="mesh1d.plotOverlapManager"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d.plotOverlapManager">[docs]</a>    <span class="k">def</span> <span class="nf">plotOverlapManager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overlap</span><span class="p">):</span>
        <span class="s2">&quot;Plot all mesh overlaps in an overlap manager.&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshOverlaps</span> <span class="kn">import</span> <span class="nn">overlapManager</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">overlapManager</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subdomain</span> <span class="ow">in</span> <span class="n">overlap</span><span class="o">.</span><span class="n">overlaps</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="n">overlap</span><span class="o">.</span><span class="n">overlaps</span><span class="p">[</span><span class="n">subdomain</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="n">cellNo</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cellNo</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="mesh1d.plotAlgebraicOverlap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d.plotAlgebraicOverlap">[docs]</a>    <span class="k">def</span> <span class="nf">plotAlgebraicOverlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">overlap</span><span class="p">):</span>
        <span class="s2">&quot;Plot a single algebraic overlap.&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">algebraicOverlaps</span> <span class="kn">import</span> <span class="nn">algebraicOverlap</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">algebraicOverlap</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">boundary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dofDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dof</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">overlap</span><span class="o">.</span><span class="n">shared_dofs</span><span class="p">):</span>
            <span class="n">dofDict</span><span class="p">[</span><span class="n">dof</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">simplex</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dofDict</span><span class="p">[</span><span class="n">dof</span><span class="p">]))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span></div>

<div class="viewcode-block" id="mesh1d.plotAlgebraicOverlapManager"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d.plotAlgebraicOverlapManager">[docs]</a>    <span class="k">def</span> <span class="nf">plotAlgebraicOverlapManager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">overlap</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">algebraicOverlaps</span> <span class="kn">import</span> <span class="nn">algebraicOverlapManager</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">algebraicOverlapManager</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">boundary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subdomainNo</span> <span class="ow">in</span> <span class="n">overlap</span><span class="o">.</span><span class="n">overlaps</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dof</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">overlap</span><span class="o">.</span><span class="n">overlaps</span><span class="p">[</span><span class="n">subdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">shared_dofs</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">dof</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotFunctionDoFMap</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="mesh1d.plotFunctionDoFMap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d.plotFunctionDoFMap">[docs]</a>    <span class="k">def</span> <span class="nf">plotFunctionDoFMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="s2">&quot;Display function values for every DoF.&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dof</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">simplex</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:.2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">dof</span><span class="p">]))</span></div>

<div class="viewcode-block" id="mesh1d.sortVertices"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh1d.sortVertices">[docs]</a>    <span class="k">def</span> <span class="nf">sortVertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reorderVertices</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="mesh2d"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d">[docs]</a><span class="k">class</span> <span class="nc">mesh2d</span><span class="p">(</span><span class="n">meshNd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2D mesh</span>

<span class="sd">    Attributes:</span>
<span class="sd">    vertices</span>
<span class="sd">    cells</span>
<span class="sd">    boundaryVertices</span>
<span class="sd">    boundaryEdges</span>
<span class="sd">    boundaryVertexTags</span>
<span class="sd">    boundaryEdgeTags</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="mesh2d.getInteriorMap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.getInteriorMap">[docs]</a>    <span class="k">def</span> <span class="nf">getInteriorMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a map from the vertex numbers of the mesh</span>
<span class="sd">        to the interior vertices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bdofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBoundaryVerticesByTag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="n">iV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="n">iV</span><span class="p">[</span><span class="n">bdofs</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iV</span> <span class="o">=</span> <span class="n">iV</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mapping</span><span class="p">[</span><span class="n">iV</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iV</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mapping</span></div>

<div class="viewcode-block" id="mesh2d.plot"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">triangles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span>
        <span class="n">lenX</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">lenY</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">Y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">lenX</span><span class="o">*</span><span class="n">padding</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">lenX</span><span class="o">*</span><span class="n">padding</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">lenY</span><span class="o">*</span><span class="n">padding</span><span class="p">,</span> <span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">lenY</span><span class="o">*</span><span class="n">padding</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">triangles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span> <span class="k">if</span> <span class="n">boundary</span> <span class="k">else</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;alpha&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="k">if</span> <span class="n">boundary</span> <span class="k">else</span> <span class="mf">1.</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">triplot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">boundary</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">)</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">)</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gist_rainbow&#39;</span><span class="p">)</span>
            <span class="n">num_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">tag</span><span class="p">:</span> <span class="n">cm</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="p">(</span><span class="n">num_colors</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">tags</span><span class="p">))}</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span>
            <span class="k">for</span> <span class="n">bv</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">):</span>
                <span class="n">XY</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">bv</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span>
                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="o">*</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">],</span>
                         <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">tag</span><span class="p">],</span>
                         <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">be</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">):</span>
                <span class="n">XY</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">be</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">XY</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">XY</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span>
                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">],</span>
                         <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">tag</span><span class="p">],</span>
                         <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">)</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">)</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gist_rainbow&#39;</span><span class="p">)</span>
            <span class="n">num_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">tag</span><span class="p">:</span> <span class="n">cm</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">num_colors</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tags</span><span class="p">)}</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">):</span>
                <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="o">+</span> <span class="n">vertices</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                            <span class="o">+</span> <span class="n">vertices</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span><span class="o">/</span><span class="mi">3</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">midpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">midpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;italic&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vertices</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">vno</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">vno</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                         <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">)):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="n">vertices</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span></div>

<div class="viewcode-block" id="mesh2d.plotPrepocess"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotPrepocess">[docs]</a>    <span class="k">def</span> <span class="nf">plotPrepocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">DoFMap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">DoFMaps</span> <span class="kn">import</span> <span class="nn">P1_DoFMap</span><span class="o">,</span> <span class="nn">P0_DoFMap</span>
        <span class="k">if</span> <span class="n">DoFMap</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">,</span> <span class="n">P0_DoFMap</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">.</span> <span class="n">DoFMaps</span> <span class="kn">import</span> <span class="nn">getSubMapRestrictionProlongation</span>
                <span class="n">dm</span> <span class="o">=</span> <span class="n">P0_DoFMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">getSubMapRestrictionProlongation</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">P</span><span class="o">*</span><span class="n">x</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotPrepocess</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotPrepocess</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">DoFMap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">,</span> <span class="n">P1_DoFMap</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotPrepocess</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">linearPart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">DoFMap</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">,</span> <span class="n">P1_DoFMap</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">:</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">dm</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">augmentWithZero</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">dm</span> <span class="o">=</span> <span class="n">DoFMap</span>
            <span class="n">v2d</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="n">dm</span><span class="o">.</span><span class="n">dofs_per_vertex</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
            <span class="n">dm</span><span class="o">.</span><span class="n">getVertexDoFs</span><span class="p">(</span><span class="n">v2d</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">):</span>
                <span class="n">z</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">v2d</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotPrepocess</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">DoFMap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">tag</span>
                <span class="n">sol</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getInteriorVerticesByTag</span><span class="p">(</span><span class="n">tag</span><span class="p">)]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">sol</span></div>

<div class="viewcode-block" id="mesh2d.plotFunction"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotFunction">[docs]</a>    <span class="k">def</span> <span class="nf">plotFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DoFMap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contour</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotPrepocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">update</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">contour</span><span class="p">:</span>
                    <span class="n">update2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">])</span>
                    <span class="n">update</span> <span class="o">=</span> <span class="p">[</span><span class="n">update</span><span class="p">,</span> <span class="n">update2</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">update</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">contour</span><span class="p">:</span>
                    <span class="n">update</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="n">update</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                        <span class="n">cp</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                    <span class="n">update</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">update</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.</span> <span class="n">DoFMaps</span> <span class="kn">import</span> <span class="nn">P0_DoFMap</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">,</span> <span class="n">P0_DoFMap</span><span class="p">):</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span> <span class="o">==</span> <span class="n">sol</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">newVertices</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">),</span>
                                            <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
                <span class="n">newCells</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                         <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
                <span class="n">newSol</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">,</span> <span class="p">),</span>
                                       <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">vertexNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">vertex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
                            <span class="n">newVertices</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">vertex</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="n">newCells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
                        <span class="n">newSol</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">cellNo</span><span class="o">+</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="n">cellNo</span><span class="p">]</span>
                        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">newVertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">newVertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">newSol</span>
                <span class="n">cells</span> <span class="o">=</span> <span class="n">newCells</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="mesh2d.plotDoFMap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotDoFMap">[docs]</a>    <span class="k">def</span> <span class="nf">plotDoFMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">printDoFIndices</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="s2">&quot;Plot the DoF numbers on the mesh.&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc_context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">getDoFCoordinates</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">printDoFIndices</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">rc_context</span><span class="p">({</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}):</span>
                <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">dof</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="n">dof</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">dof</span><span class="p">),</span>
                             <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                             <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="mesh2d.plotFunctionDoFMap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotFunctionDoFMap">[docs]</a>    <span class="k">def</span> <span class="nf">plotFunctionDoFMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="s2">&quot;Display function values for every DoF.&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dof</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">simplex</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">{:.2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">dof</span><span class="p">]))</span></div>

<div class="viewcode-block" id="mesh2d.plotInterface"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotInterface">[docs]</a>    <span class="k">def</span> <span class="nf">plotInterface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">):</span>
        <span class="s2">&quot;Plot a single mesh interface.&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshOverlaps</span> <span class="kn">import</span> <span class="nn">meshInterface</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">meshInterface</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">num_edges</span><span class="p">):</span>
            <span class="n">cellNo</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">edgeNo</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
            <span class="k">if</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">order</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">XY</span> <span class="o">=</span> <span class="n">simplex</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">XY</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">XY</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span>
                     <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                     <span class="c1"># color=colors[tag],</span>
                     <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">XY</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">XY</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="mesh2d.plotMeshOverlap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotMeshOverlap">[docs]</a>    <span class="k">def</span> <span class="nf">plotMeshOverlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overlap</span><span class="p">):</span>
        <span class="s2">&quot;Plot a single mesh overlap.&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshOverlaps</span> <span class="kn">import</span> <span class="nn">meshOverlap</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">meshOverlap</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="c1"># self.plot(boundary=True)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">overlap</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">overlap</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">overlap</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">overlap</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="n">cellNo</span> <span class="o">=</span> <span class="n">overlap</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
            <span class="n">XY</span> <span class="o">=</span> <span class="n">simplex</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Overlap of subdomain </span><span class="si">{}</span><span class="s1"> with </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">overlap</span><span class="o">.</span><span class="n">mySubdomainNo</span><span class="p">,</span> <span class="n">overlap</span><span class="o">.</span><span class="n">otherSubdomainNo</span><span class="p">))</span></div>

<div class="viewcode-block" id="mesh2d.plotOverlapManager"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotOverlapManager">[docs]</a>    <span class="k">def</span> <span class="nf">plotOverlapManager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overlap</span><span class="p">):</span>
        <span class="s2">&quot;Plot all mesh overlaps in an overlap manager.&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshOverlaps</span> <span class="kn">import</span> <span class="nn">overlapManager</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">overlapManager</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subdomain</span> <span class="ow">in</span> <span class="n">overlap</span><span class="o">.</span><span class="n">overlaps</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="n">overlap</span><span class="o">.</span><span class="n">overlaps</span><span class="p">[</span><span class="n">subdomain</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="n">cellNo</span><span class="p">]</span> <span class="o">+=</span> <span class="n">subdomain</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="mesh2d.plotAlgebraicOverlap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotAlgebraicOverlap">[docs]</a>    <span class="k">def</span> <span class="nf">plotAlgebraicOverlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">overlap</span><span class="p">):</span>
        <span class="s2">&quot;Plot a single algebraic overlap.&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">algebraicOverlaps</span> <span class="kn">import</span> <span class="nn">algebraicOverlap</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">algebraicOverlap</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">boundary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dofDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dof</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">overlap</span><span class="o">.</span><span class="n">shared_dofs</span><span class="p">):</span>
            <span class="n">dofDict</span><span class="p">[</span><span class="n">dof</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">simplex</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">dofDict</span><span class="p">[</span><span class="n">dof</span><span class="p">]))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span></div>

<div class="viewcode-block" id="mesh2d.plotAlgebraicOverlapManager"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotAlgebraicOverlapManager">[docs]</a>    <span class="k">def</span> <span class="nf">plotAlgebraicOverlapManager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">overlap</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">algebraicOverlaps</span> <span class="kn">import</span> <span class="nn">algebraicOverlapManager</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">algebraicOverlapManager</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">boundary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subdomainNo</span> <span class="ow">in</span> <span class="n">overlap</span><span class="o">.</span><span class="n">overlaps</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dof</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">overlap</span><span class="o">.</span><span class="n">overlaps</span><span class="p">[</span><span class="n">subdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">shared_dofs</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">dof</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotFunctionDoFMap</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="mesh2d.plotVertexPartitions"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotVertexPartitions">[docs]</a>    <span class="k">def</span> <span class="nf">plotVertexPartitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numPartitions</span><span class="p">,</span> <span class="n">partitioner</span><span class="o">=</span><span class="s1">&#39;metis&#39;</span><span class="p">,</span>
                             <span class="n">interior</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partitioner</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">partitioner</span> <span class="o">==</span> <span class="s1">&#39;metis&#39;</span><span class="p">:</span>
                <span class="n">partitioner</span> <span class="o">=</span> <span class="n">metisMeshPartitioner</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">partitioner</span> <span class="o">==</span> <span class="s1">&#39;regular&#39;</span><span class="p">:</span>
                <span class="n">partitioner</span> <span class="o">=</span> <span class="n">regularMeshPartitioner</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
            <span class="n">part</span><span class="p">,</span> <span class="n">numPartitions</span> <span class="o">=</span> <span class="n">partitioner</span><span class="o">.</span><span class="n">partitionVertices</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">,</span>
                                                                <span class="n">interior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partitioner</span><span class="p">,</span> <span class="n">sparseGraph</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">partitioner</span><span class="o">.</span><span class="n">nnz</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">partitioner</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">partitioner</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">partitioner</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">part</span><span class="p">[</span><span class="n">partitioner</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span>
            <span class="n">numPartitions</span> <span class="o">=</span> <span class="n">partitioner</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gist_rainbow&#39;</span><span class="p">)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">lenX</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">lenY</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">Y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">lenX</span><span class="o">*</span><span class="n">padding</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">lenX</span><span class="o">*</span><span class="n">padding</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">lenY</span><span class="o">*</span><span class="n">padding</span><span class="p">,</span> <span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">lenY</span><span class="o">*</span><span class="n">padding</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">part</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">part2</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">part2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">interiorVertices</span><span class="p">]</span> <span class="o">=</span> <span class="n">part</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">part2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span>
                            <span class="n">part</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span>
                            <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span>
                            <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">cm</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">numPartitions</span><span class="p">)])</span></div>

<div class="viewcode-block" id="mesh2d.plotCellPartitions"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotCellPartitions">[docs]</a>    <span class="k">def</span> <span class="nf">plotCellPartitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numPartitions</span><span class="p">,</span> <span class="n">partitioner</span><span class="o">=</span><span class="s1">&#39;metis&#39;</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partitioner</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">partitioner</span> <span class="o">==</span> <span class="s1">&#39;metis&#39;</span><span class="p">:</span>
                <span class="n">partitioner</span> <span class="o">=</span> <span class="n">metisMeshPartitioner</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">partitioner</span> <span class="o">==</span> <span class="s1">&#39;regular&#39;</span><span class="p">:</span>
                <span class="n">partitioner</span> <span class="o">=</span> <span class="n">regularMeshPartitioner</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="n">part</span><span class="p">,</span> <span class="n">numPartitions</span> <span class="o">=</span> <span class="n">partitioner</span><span class="o">.</span><span class="n">partitionCells</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span> <span class="n">part</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">triplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="mesh2d.plotGraph"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.plotGraph">[docs]</a>    <span class="k">def</span> <span class="nf">plotGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">dofmap</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">PyNucleus_base.linear_operators</span> <span class="kn">import</span> <span class="n">CSR_LinearOperator</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">CSR_LinearOperator</span><span class="p">)</span>
        <span class="n">dof2vertex</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">dofmap</span><span class="o">.</span><span class="n">getNodalCoordinates_py</span><span class="p">(</span><span class="n">simplex</span><span class="p">)</span>
            <span class="n">dofs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dofmap</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
                <span class="n">dofs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dofmap</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dof1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dofs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dof1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dof2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dofs</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">dof2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">getEntry_py</span><span class="p">(</span><span class="n">dof1</span><span class="p">,</span> <span class="n">dof2</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                                     <span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                                     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                     <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                     <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                                     <span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                                     <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="mesh2d.sortVertices"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh2d.sortVertices">[docs]</a>    <span class="k">def</span> <span class="nf">sortVertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;d,d&#39;</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span><span class="s1">&#39;f0&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reorderVertices</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="mesh3d"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh3d">[docs]</a><span class="k">class</span> <span class="nc">mesh3d</span><span class="p">(</span><span class="n">meshNd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    3D mesh</span>

<span class="sd">    Attributes:</span>
<span class="sd">    vertices</span>
<span class="sd">    cells</span>
<span class="sd">    boundaryVertices</span>
<span class="sd">    boundaryEdges</span>
<span class="sd">    boundaryFaces</span>
<span class="sd">    boundaryVertexTags</span>
<span class="sd">    boundaryEdgeTags</span>
<span class="sd">    boundaryFaceTags</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="mesh3d.plot"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh3d.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
        <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="p">:]</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">:]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="mesh3d.plot_surface"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh3d.plot_surface">[docs]</a>    <span class="k">def</span> <span class="nf">plot_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.art3d</span> <span class="kn">import</span> <span class="n">Poly3DCollection</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
        <span class="c1"># from itertools import combinations</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="c1"># for i in range(self.boundaryFaces.shape[0]):</span>
        <span class="c1">#     for j, k in combinations(range(3), 2):</span>
        <span class="c1">#         u = self.vertices[self.boundaryFaces[i, j], :]</span>
        <span class="c1">#         v = self.vertices[self.boundaryFaces[i, k], :]</span>
        <span class="c1">#         ax.plot([u[0], v[0]], [u[1], v[1]], [u[2], v[2]], &#39;k&#39;, zorder=-1)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaceTags</span><span class="p">)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">)</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gist_rainbow&#39;</span><span class="p">)</span>
        <span class="n">num_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">tag</span><span class="p">:</span> <span class="n">cm</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">num_colors</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tags</span><span class="p">)}</span>
        <span class="n">tri</span> <span class="o">=</span> <span class="n">Poly3DCollection</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
                               <span class="n">facecolors</span><span class="o">=</span><span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaceTags</span><span class="p">],</span>
                               <span class="n">edgecolors</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">boundary</span><span class="p">:</span>
            <span class="n">scatterDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">bv</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">):</span>
                <span class="n">XY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">bv</span><span class="p">,</span> <span class="p">:]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">scatterDict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">scatterDict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">XY</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">scatterDict</span><span class="p">:</span>
                <span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">scatterDict</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">XY</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">XY</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">XY</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">zs</span><span class="o">=</span><span class="n">XY</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                            <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">tag</span><span class="p">],</span>
                            <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                            <span class="n">depthshade</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
            <span class="c1"># for be, tag in zip(self.boundaryEdges, self.boundaryEdgeTags):</span>
            <span class="c1">#     XY = self.vertices[be, :]</span>
            <span class="c1">#     plt.plot(XY[:, 0], XY[:, 1], &#39;k-&#39;, zs=XY[:, 2],</span>
            <span class="c1">#              linewidth=3*rcParams[&quot;lines.linewidth&quot;],</span>
            <span class="c1">#              color=colors[tag],</span>
            <span class="c1">#              zorder=2)</span>

<div class="viewcode-block" id="mesh3d.plotVTK"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh3d.plotVTK">[docs]</a>    <span class="k">def</span> <span class="nf">plotVTK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">vtk</span>
        <span class="kn">from</span> <span class="nn">vtk.util.numpy_support</span> <span class="kn">import</span> <span class="n">numpy_to_vtk</span><span class="p">,</span> <span class="n">numpy_to_vtkIdTypeArray</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="n">points</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPoints</span><span class="p">()</span>
        <span class="n">points</span><span class="o">.</span><span class="n">SetData</span><span class="p">(</span><span class="n">numpy_to_vtk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gist_rainbow&#39;</span><span class="p">)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaceTags</span><span class="p">)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">)</span>
        <span class="n">num_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">ccs</span> <span class="o">=</span> <span class="p">{</span><span class="n">tag</span><span class="p">:</span> <span class="n">cm</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">num_colors</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tags</span><span class="p">)}</span>

        <span class="k">if</span> <span class="n">boundary</span><span class="p">:</span>
            <span class="n">toPlot</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryFaceTags</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">toPlot</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">))]</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkUnsignedCharArray</span><span class="p">()</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="s2">&quot;Colors&quot;</span><span class="p">)</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">SetNumberOfComponents</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">SetNumberOfTuples</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">cells</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">toPlot</span><span class="p">]))</span>
        <span class="n">myCells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">myCellTypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">numCells</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cells</span><span class="p">,</span> <span class="n">tags</span> <span class="ow">in</span> <span class="n">toPlot</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cellType</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_VERTEX</span>
            <span class="k">elif</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cellType</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_LINE</span>
            <span class="k">elif</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">cellType</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_TRIANGLE</span>
            <span class="k">elif</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">cellType</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_TETRA</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
            <span class="n">myCellTypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cellType</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">))</span>
            <span class="n">myCells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
                                      <span class="n">cells</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)))</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="n">numCells</span> <span class="o">+=</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">ccs</span><span class="p">[</span><span class="n">tags</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">InsertTuple3</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">255</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">255</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">255</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">myCells</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">numpy_to_vtkIdTypeArray</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellArray</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetCells</span><span class="p">(</span><span class="n">numCells</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>

        <span class="n">ugrid</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkUnstructuredGrid</span><span class="p">()</span>
        <span class="n">cellTypes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">myCellTypes</span><span class="p">)</span>
        <span class="n">ugrid</span><span class="o">.</span><span class="n">SetCells</span><span class="p">(</span><span class="n">cellTypes</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">ugrid</span><span class="o">.</span><span class="n">SetPoints</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">ugrid</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span><span class="o">.</span><span class="n">SetScalars</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

        <span class="n">ugridMapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkDataSetMapper</span><span class="p">()</span>
        <span class="n">ugridMapper</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">ugrid</span><span class="p">)</span>

        <span class="n">ugridActor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
        <span class="n">ugridActor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">ugridMapper</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">boundary</span><span class="p">:</span>
            <span class="n">ugridActor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">EdgeVisibilityOn</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ugridActor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetLineWidth</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">ugridActor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetPointSize</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">ugridActor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="n">opacity</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ugridActor</span></div>

<div class="viewcode-block" id="mesh3d.plotInterfaceVTK"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh3d.plotInterfaceVTK">[docs]</a>    <span class="k">def</span> <span class="nf">plotInterfaceVTK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">vtk</span>
        <span class="kn">from</span> <span class="nn">vtk.util.numpy_support</span> <span class="kn">import</span> <span class="n">numpy_to_vtk</span><span class="p">,</span> <span class="n">numpy_to_vtkIdTypeArray</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshOverlaps</span> <span class="kn">import</span> <span class="nn">sharedMesh</span><span class="o">,</span> <span class="nn">simplexMapper3D</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">sharedMesh</span><span class="p">)</span>

        <span class="n">points</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPoints</span><span class="p">()</span>
        <span class="n">points</span><span class="o">.</span><span class="n">SetData</span><span class="p">(</span><span class="n">numpy_to_vtk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">sM</span> <span class="o">=</span> <span class="n">simplexMapper3D</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">cellsCells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">interface</span><span class="o">.</span><span class="n">cells</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">cellsFaces</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="n">interface</span><span class="o">.</span><span class="n">num_faces</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">num_faces</span><span class="p">):</span>
            <span class="n">cellsFaces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sM</span><span class="o">.</span><span class="n">getFaceInCell_py</span><span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">interface</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">cellsEdges</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="n">interface</span><span class="o">.</span><span class="n">num_edges</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">num_edges</span><span class="p">):</span>
            <span class="n">cellsEdges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sM</span><span class="o">.</span><span class="n">getEdgeInCell_py</span><span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">interface</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">cellsVertices</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="n">interface</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">):</span>
            <span class="n">cellsVertices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sM</span><span class="o">.</span><span class="n">getVertexInCell_py</span><span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                        <span class="n">interface</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">toPlot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">cellsCells</span><span class="p">,</span> <span class="n">cellsFaces</span><span class="p">,</span> <span class="n">cellsEdges</span><span class="p">,</span> <span class="n">cellsVertices</span>
        <span class="p">]</span>

        <span class="n">myCells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">myCellTypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">numCells</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cells</span> <span class="ow">in</span> <span class="n">toPlot</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cellType</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_VERTEX</span>
            <span class="k">elif</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cellType</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_LINE</span>
            <span class="k">elif</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">cellType</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_TRIANGLE</span>
            <span class="k">elif</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">cellType</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_TETRA</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
            <span class="n">myCellTypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cellType</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">))</span>
            <span class="n">myCells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
                                      <span class="n">cells</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)))</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="n">numCells</span> <span class="o">+=</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">myCells</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">numpy_to_vtkIdTypeArray</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellArray</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetCells</span><span class="p">(</span><span class="n">numCells</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>

        <span class="n">ugrid</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkUnstructuredGrid</span><span class="p">()</span>
        <span class="n">cellTypes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">myCellTypes</span><span class="p">)</span>
        <span class="n">ugrid</span><span class="o">.</span><span class="n">SetCells</span><span class="p">(</span><span class="n">cellTypes</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">ugrid</span><span class="o">.</span><span class="n">SetPoints</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

        <span class="n">ugridMapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkDataSetMapper</span><span class="p">()</span>
        <span class="n">ugridMapper</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">ugrid</span><span class="p">)</span>

        <span class="n">ugridActor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
        <span class="n">ugridActor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">ugridMapper</span><span class="p">)</span>
        <span class="n">ugridActor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetLineWidth</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ugridActor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetPointSize</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ugridActor</span></div>

<div class="viewcode-block" id="mesh3d.get_surface_mesh"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh3d.get_surface_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">get_surface_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mesh2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBoundaryFacesByTag</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span></div>

<div class="viewcode-block" id="mesh3d.checkDoFMap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh3d.checkDoFMap">[docs]</a>    <span class="k">def</span> <span class="nf">checkDoFMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">):</span>
        <span class="s2">&quot;Plot the DoF numbers on the mesh.&quot;</span>
        <span class="n">recorderdDofs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="n">simplex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dof</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DoFMap</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">simplex</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">posOld</span> <span class="o">=</span> <span class="n">recorderdDofs</span><span class="p">[</span><span class="n">dof</span><span class="p">]</span>
                        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">posOld</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">recorderdDofs</span><span class="p">[</span><span class="n">dof</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">return</span> <span class="n">recorderdDofs</span></div>

<div class="viewcode-block" id="mesh3d.sortVertices"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.mesh3d.sortVertices">[docs]</a>    <span class="k">def</span> <span class="nf">sortVertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;d,d,d&#39;</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">,</span> <span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;f0&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reorderVertices</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="stitchSubdomains"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.stitchSubdomains">[docs]</a><span class="k">def</span> <span class="nf">stitchSubdomains</span><span class="p">(</span><span class="n">subdomains</span><span class="p">,</span> <span class="n">overlapManagers</span><span class="p">,</span> <span class="n">returnR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ncs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stitch subdomains together.</span>
<span class="sd">    Works for 2D.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">subdomains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">subdomains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">globalIndices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">numPartitions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subdomains</span><span class="p">)</span>
    <span class="c1"># FIX: If we have real overlap (overlapping elements, not vertices),</span>
    <span class="c1">#      I&#39;m adding vertices twice</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ncs</span><span class="p">:</span>
            <span class="n">subdomainVertices</span> <span class="o">=</span> <span class="n">subdomains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:</span><span class="n">ncs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subdomainVertices</span> <span class="o">=</span> <span class="n">subdomains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span>
        <span class="n">subdomainNumVertices</span> <span class="o">=</span> <span class="n">subdomainVertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># form vector bv</span>
        <span class="c1"># if vertex is in previous subdomains, set number of a subdomain, else -1</span>
        <span class="n">bv</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">subdomainNumVertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="c1"># loop over all overlaps with subdomains that we already incorporated</span>
        <span class="c1"># for j in range(i-1, -1, -1):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">bv</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">overlapManagers</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">overlap2local</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)]</span> <span class="o">=</span> <span class="n">j</span>
        <span class="c1"># append all new vertices</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
        <span class="n">nv</span> <span class="o">=</span> <span class="p">(</span><span class="n">bv</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">vertices</span><span class="p">,</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">nv</span><span class="p">,</span> <span class="n">subdomainVertices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>

        <span class="c1"># find new indices after discarding of the known vertices</span>
        <span class="n">globalIndicesSubdomain</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">(</span><span class="n">subdomainNumVertices</span><span class="p">,</span>
                                          <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="n">globalIndicesSubdomain</span><span class="p">[</span><span class="n">nv</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="n">nv</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">nv</span><span class="p">),</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">subdomainNumVertices</span><span class="p">)):</span>
            <span class="n">otherSubdomain</span> <span class="o">=</span> <span class="n">bv</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="c1"># translate to overlap index in domain i</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">overlapManagers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">translate_local_overlap</span><span class="p">(</span><span class="n">otherSubdomain</span><span class="p">,</span>
                                                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">j</span><span class="p">]))</span>
            <span class="c1"># translate to local index in domain otherSubdomain</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">overlapManagers</span><span class="p">[</span><span class="n">otherSubdomain</span><span class="p">]</span><span class="o">.</span><span class="n">translate_overlap_local</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
            <span class="c1"># translate to global index</span>
            <span class="n">globalIndicesSubdomain</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">globalIndices</span><span class="p">[</span><span class="n">otherSubdomain</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
        <span class="n">globalIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">globalIndicesSubdomain</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ncs</span><span class="p">:</span>
            <span class="n">subdomainCells</span> <span class="o">=</span> <span class="n">subdomains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[:</span><span class="n">ncs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
            <span class="n">addCell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">subdomainCells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subdomainCells</span> <span class="o">=</span> <span class="n">subdomains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span>
            <span class="c1"># translate cells to new indices</span>
            <span class="c1"># get subdomain number for every vertex in every cell</span>
            <span class="n">ww</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bv</span><span class="p">,</span> <span class="n">subdomainCells</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="c1"># take cell wise min</span>
            <span class="n">cellMinSubdomain</span> <span class="o">=</span> <span class="n">ww</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># take cell wise max</span>
            <span class="n">cellMaxSubdomain</span> <span class="o">=</span> <span class="n">ww</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># only take cells that have at least one new vertex,</span>
            <span class="c1"># or that have vertices on different subdomains</span>
            <span class="c1"># FIX: the last condition is not obvious</span>
            <span class="n">addCell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">cellMinSubdomain</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">cellMinSubdomain</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                   <span class="n">cellMinSubdomain</span> <span class="o">&lt;</span> <span class="n">cellMaxSubdomain</span><span class="p">))</span>
            <span class="c1"># addCell = cellMinSubdomain == -1</span>
            <span class="c1"># xx = np.logical_and(cellMinSubdomain &gt; -1,</span>
            <span class="c1">#                 cellMinSubdomain &lt; cellMaxSubdomain)</span>
            <span class="c1"># print(i, xx.sum())</span>
            <span class="c1"># print(ww[:, xx])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">addCell</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">subdomains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">newcells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">addCell</span><span class="p">,</span> <span class="n">subdomainCells</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">newcells</span> <span class="o">=</span> <span class="n">globalIndicesSubdomain</span><span class="p">[</span><span class="n">newcells</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">cells</span><span class="p">,</span> <span class="n">newcells</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">subdomains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh1d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">subdomains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">subdomains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh3d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">returnR</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">globalIndices</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mesh</span></div>


<div class="viewcode-block" id="stitchOverlappingMeshes"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.stitchOverlappingMeshes">[docs]</a><span class="k">def</span> <span class="nf">stitchOverlappingMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">overlapManagers</span><span class="p">):</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span>
    <span class="n">global_vertices</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
    <span class="n">global_cells</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">global_boundary_vertices</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">global_boundary_edges</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">numPartitions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">meshes</span><span class="p">)</span>
    <span class="n">localCellLookup</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">globalCellLookup</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">mySubdomainNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">):</span>
        <span class="n">translate</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">num_cells</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">otherSubdomainNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mySubdomainNo</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">otherSubdomainNo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">overlapManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">overlaps</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">overlapManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">overlaps</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">overlapManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">overlaps</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">overlapManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">overlaps</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">overlapManagers</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">overlaps</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells_as_array</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="p">:]]</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells_as_array</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">lookup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">globalCellLookup</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">][</span><span class="n">q</span><span class="p">]</span>
        <span class="c1"># get global vertex indices</span>
        <span class="n">numVertices</span> <span class="o">=</span> <span class="n">numVerticesNew</span> <span class="o">=</span> <span class="n">global_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">translate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">translate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">numVerticesNew</span>
                <span class="n">numVerticesNew</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># translate vertex indices in cells to global indices</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]]</span>
        <span class="n">global_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">global_vertices</span><span class="p">,</span>
                                     <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">translate</span> <span class="o">&gt;=</span> <span class="n">numVertices</span><span class="p">,</span> <span class="p">:]))</span>
        <span class="n">num_cells</span> <span class="o">=</span> <span class="n">global_cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">global_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">global_cells</span><span class="p">,</span>
                                  <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells_as_array</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]))</span>

        <span class="k">for</span> <span class="n">vertexNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">global_boundary_vertices</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">global_boundary_vertices</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">edgeNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                 <span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">localCellLookup</span><span class="p">[</span><span class="n">num_cells</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">mySubdomainNo</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span>
                <span class="n">lookup</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_cells</span>
                <span class="n">num_cells</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">localCellLookup</span><span class="p">[</span><span class="n">lookup</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mySubdomainNo</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
        <span class="n">globalCellLookup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookup</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">global_mesh</span> <span class="o">=</span> <span class="n">mesh1d</span><span class="p">(</span><span class="n">global_vertices</span><span class="p">,</span> <span class="n">global_cells</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">global_mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">global_vertices</span><span class="p">,</span> <span class="n">global_cells</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
    <span class="n">boundaryVertices</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_vertices</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">boundaryVertexTags</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_vertices</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vertexNo</span><span class="p">,</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">global_boundary_vertices</span><span class="p">):</span>
        <span class="n">boundaryVertices</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertex</span>
        <span class="n">global_boundary_vertices</span><span class="p">[</span><span class="n">vertex</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">global_boundary_vertices</span><span class="p">[</span><span class="n">vertex</span><span class="p">]))</span>
        <span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">global_boundary_vertices</span><span class="p">[</span><span class="n">vertex</span><span class="p">])</span>
    <span class="n">global_mesh</span><span class="o">.</span><span class="n">_boundaryVertices</span> <span class="o">=</span> <span class="n">boundaryVertices</span>
    <span class="n">global_mesh</span><span class="o">.</span><span class="n">_boundaryVertexTags</span> <span class="o">=</span> <span class="n">boundaryVertexTags</span>

    <span class="n">boundaryEdges</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_edges</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">boundaryEdgeTags</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_edges</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">edgeNo</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">global_boundary_edges</span><span class="p">):</span>
        <span class="n">boundaryEdges</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">edge</span>
        <span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]))</span>
        <span class="c1"># assert len(global_boundary_edges[edge]) == 1, global_boundary_edges[edge]</span>
        <span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">edge</span><span class="p">])</span>
    <span class="n">global_mesh</span><span class="o">.</span><span class="n">_boundaryEdges</span> <span class="o">=</span> <span class="n">boundaryEdges</span>
    <span class="n">global_mesh</span><span class="o">.</span><span class="n">_boundaryEdgeTags</span> <span class="o">=</span> <span class="n">boundaryEdgeTags</span>
    <span class="k">return</span> <span class="n">global_mesh</span><span class="p">,</span> <span class="n">localCellLookup</span></div>


<div class="viewcode-block" id="stitchNonoverlappingMeshes"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.stitchNonoverlappingMeshes">[docs]</a><span class="k">def</span> <span class="nf">stitchNonoverlappingMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">interfaceManagers</span><span class="p">):</span>
    <span class="n">global_vertices</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">meshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
    <span class="n">global_cells</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">meshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">numPartitions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">meshes</span><span class="p">)</span>
    <span class="n">localCellLookup</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">global_boundary_vertices</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">global_boundary_edges</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">global_boundary_faces</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">mySubdomainNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">):</span>
        <span class="n">translate</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">otherSubdomainNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mySubdomainNo</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">otherSubdomainNo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># idx[interfaceManagers[mySubdomainNo].overlaps[otherSubdomainNo].cells] = False</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">cellNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">vertexNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo</span><span class="p">]</span>
                <span class="n">cellNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">vertexNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo</span><span class="p">]</span>
                <span class="n">translate</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
            <span class="k">if</span> <span class="n">meshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">cellNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">edgeNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span>
                    <span class="k">elif</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>
                    <span class="k">elif</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
                    <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo1</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo1</span><span class="p">]</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">]</span>

                    <span class="n">cellNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">edgeNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span>
                    <span class="k">elif</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>
                    <span class="k">elif</span> <span class="n">edgeNo</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
                    <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span> <span class="o">=</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo1</span>
                    <span class="n">q1</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo1</span><span class="p">]</span>
                    <span class="n">q2</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">]</span>

                    <span class="n">translate</span><span class="p">[</span><span class="n">p1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q1</span>
                    <span class="n">translate</span><span class="p">[</span><span class="n">p2</span><span class="p">]</span> <span class="o">=</span> <span class="n">q2</span>
            <span class="c1"># missing faces here</span>
            <span class="k">if</span> <span class="n">meshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">cellNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">faceNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">faceNo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = 2, 1, 0</span>
                    <span class="k">elif</span> <span class="n">faceNo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = 0, 4, 3</span>
                    <span class="k">elif</span> <span class="n">faceNo</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = 1, 5, 4</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = 2, 3, 5</span>

                    <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span><span class="p">,</span> <span class="n">vertexNo1</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = edgeNo2, edgeNo3, edgeNo1</span>
                    <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="n">vertexNo3</span><span class="p">,</span> <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = edgeNo3, edgeNo1, edgeNo2</span>
                    <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo3</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = edgeNo1, edgeNo3, edgeNo2</span>
                    <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo3</span><span class="p">,</span> <span class="n">vertexNo2</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = edgeNo3, edgeNo2, edgeNo1</span>
                    <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="n">vertexNo3</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo1</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = edgeNo2, edgeNo1, edgeNo3</span>

                    <span class="n">p1</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo1</span><span class="p">]</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">]</span>
                    <span class="n">p3</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo3</span><span class="p">]</span>

                    <span class="n">cellNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">faceNo</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="n">interfaceManagers</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">faceNo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = 2, 1, 0</span>
                    <span class="k">elif</span> <span class="n">faceNo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = 0, 4, 3</span>
                    <span class="k">elif</span> <span class="n">faceNo</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = 1, 5, 4</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = 2, 3, 5</span>

                    <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span><span class="p">,</span> <span class="n">vertexNo1</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = edgeNo2, edgeNo3, edgeNo1</span>
                    <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="n">vertexNo3</span><span class="p">,</span> <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = edgeNo3, edgeNo1, edgeNo2</span>
                    <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo3</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = edgeNo1, edgeNo3, edgeNo2</span>
                    <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo3</span><span class="p">,</span> <span class="n">vertexNo2</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = edgeNo3, edgeNo2, edgeNo1</span>
                    <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                        <span class="n">vertexNo1</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo3</span> <span class="o">=</span> <span class="n">vertexNo3</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">,</span> <span class="n">vertexNo1</span>
                        <span class="c1"># edgeNo1, edgeNo2, edgeNo3 = edgeNo2, edgeNo1, edgeNo3</span>

                    <span class="n">q1</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo1</span><span class="p">]</span>
                    <span class="n">q2</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo2</span><span class="p">]</span>
                    <span class="n">q3</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">otherSubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo3</span><span class="p">]</span>

                    <span class="n">translate</span><span class="p">[</span><span class="n">p1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q1</span>
                    <span class="n">translate</span><span class="p">[</span><span class="n">p2</span><span class="p">]</span> <span class="o">=</span> <span class="n">q2</span>
                    <span class="n">translate</span><span class="p">[</span><span class="n">p3</span><span class="p">]</span> <span class="o">=</span> <span class="n">q3</span>

        <span class="n">numVertices</span> <span class="o">=</span> <span class="n">numVerticesNew</span> <span class="o">=</span> <span class="n">global_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">translate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">translate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">numVerticesNew</span>
                <span class="n">numVerticesNew</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]]</span>
        <span class="n">global_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">global_vertices</span><span class="p">,</span>
                                     <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">translate</span> <span class="o">&gt;=</span> <span class="n">numVertices</span><span class="p">,</span> <span class="p">:]))</span>
        <span class="n">num_cells</span> <span class="o">=</span> <span class="n">global_cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">global_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">global_cells</span><span class="p">,</span>
                                  <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">))</span>

        <span class="c1"># add boundary vertices to global mesh</span>
        <span class="k">for</span> <span class="n">boundaryVertexNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">vertexNo</span> <span class="o">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryVertices</span><span class="p">[</span><span class="n">boundaryVertexNo</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">translate</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">global_boundary_vertices</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">boundaryVertexNo</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">global_boundary_vertices</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">boundaryVertexNo</span><span class="p">]]</span>

        <span class="c1"># add boundary edges to global mesh</span>
        <span class="k">for</span> <span class="n">edgeNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                 <span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryEdges</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">]]</span>

        <span class="c1"># add boundary faces to global mesh</span>
        <span class="k">for</span> <span class="n">faceNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="p">[</span><span class="n">faceNo</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                 <span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="p">[</span><span class="n">faceNo</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                 <span class="n">translate</span><span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryFaces</span><span class="p">[</span><span class="n">faceNo</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">global_boundary_faces</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryFaceTags</span><span class="p">[</span><span class="n">faceNo</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">global_boundary_faces</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">boundaryFaceTags</span><span class="p">[</span><span class="n">faceNo</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">mySubdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="n">localCellLookup</span><span class="p">[</span><span class="n">num_cells</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">mySubdomainNo</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span>
            <span class="n">num_cells</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">meshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">global_mesh</span> <span class="o">=</span> <span class="n">mesh1d</span><span class="p">(</span><span class="n">global_vertices</span><span class="p">,</span> <span class="n">global_cells</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">meshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">global_mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">global_vertices</span><span class="p">,</span> <span class="n">global_cells</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">meshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">global_mesh</span> <span class="o">=</span> <span class="n">mesh3d</span><span class="p">(</span><span class="n">global_vertices</span><span class="p">,</span> <span class="n">global_cells</span><span class="p">)</span>

    <span class="n">boundaryVertices</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_vertices</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">boundaryVertexTags</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_vertices</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vertexNo</span><span class="p">,</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">global_boundary_vertices</span><span class="p">):</span>
        <span class="n">boundaryVertices</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertex</span>
        <span class="n">global_boundary_vertices</span><span class="p">[</span><span class="n">vertex</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">global_boundary_vertices</span><span class="p">[</span><span class="n">vertex</span><span class="p">]))</span>
        <span class="n">boundaryVertexTags</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">global_boundary_vertices</span><span class="p">[</span><span class="n">vertex</span><span class="p">])</span>
    <span class="n">global_mesh</span><span class="o">.</span><span class="n">_boundaryVertices</span> <span class="o">=</span> <span class="n">boundaryVertices</span>
    <span class="n">global_mesh</span><span class="o">.</span><span class="n">_boundaryVertexTags</span> <span class="o">=</span> <span class="n">boundaryVertexTags</span>

    <span class="k">if</span> <span class="n">meshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">boundaryEdges</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_edges</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="n">boundaryEdgeTags</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_edges</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">edgeNo</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">global_boundary_edges</span><span class="p">):</span>
            <span class="n">boundaryEdges</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">edge</span>
            <span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]))</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">edge</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span>
            <span class="n">boundaryEdgeTags</span><span class="p">[</span><span class="n">edgeNo</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_boundary_edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">global_mesh</span><span class="o">.</span><span class="n">_boundaryEdges</span> <span class="o">=</span> <span class="n">boundaryEdges</span>
        <span class="n">global_mesh</span><span class="o">.</span><span class="n">_boundaryEdgeTags</span> <span class="o">=</span> <span class="n">boundaryEdgeTags</span>

    <span class="k">if</span> <span class="n">meshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">boundaryFaces</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_faces</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
        <span class="n">boundaryFaceTags</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_faces</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">TAG</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">faceNo</span><span class="p">,</span> <span class="n">face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">global_boundary_faces</span><span class="p">):</span>
            <span class="n">boundaryFaces</span><span class="p">[</span><span class="n">faceNo</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">face</span>
            <span class="n">global_boundary_faces</span><span class="p">[</span><span class="n">face</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">global_boundary_faces</span><span class="p">[</span><span class="n">face</span><span class="p">]))</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_boundary_faces</span><span class="p">[</span><span class="n">face</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">global_boundary_faces</span><span class="p">[</span><span class="n">face</span><span class="p">]</span>
            <span class="n">boundaryFaceTags</span><span class="p">[</span><span class="n">faceNo</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_boundary_faces</span><span class="p">[</span><span class="n">face</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">global_mesh</span><span class="o">.</span><span class="n">_boundaryFaces</span> <span class="o">=</span> <span class="n">boundaryFaces</span>
        <span class="n">global_mesh</span><span class="o">.</span><span class="n">_boundaryFaceTags</span> <span class="o">=</span> <span class="n">boundaryFaceTags</span>

    <span class="k">return</span> <span class="n">global_mesh</span><span class="p">,</span> <span class="n">localCellLookup</span></div>


<div class="viewcode-block" id="stitchSolutions"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.stitchSolutions">[docs]</a><span class="k">def</span> <span class="nf">stitchSolutions</span><span class="p">(</span><span class="n">global_mesh</span><span class="p">,</span> <span class="n">DoFMaps</span><span class="p">,</span> <span class="n">localCellLookup</span><span class="p">,</span> <span class="n">solutions</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">DoFMaps</span> <span class="kn">import</span> <span class="nn">getAvailableDoFMaps</span><span class="o">,</span> <span class="nn">str2DoFMap</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">getAvailableDoFMaps</span><span class="p">():</span>
        <span class="n">DoFMap</span> <span class="o">=</span> <span class="n">str2DoFMap</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">DoFMaps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DoFMap</span><span class="p">):</span>
            <span class="n">dm_global</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="p">(</span><span class="n">global_mesh</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">DoFMaps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">dm_global</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">solutions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">global_mesh</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dm_global</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
            <span class="n">dofGlobal</span> <span class="o">=</span> <span class="n">dm_global</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dofGlobal</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subdomainNo</span><span class="p">,</span> <span class="n">localCellNo</span> <span class="ow">in</span> <span class="n">localCellLookup</span><span class="p">[</span><span class="n">cellNo</span><span class="p">]:</span>
                    <span class="n">dofLocal</span> <span class="o">=</span> <span class="n">DoFMaps</span><span class="p">[</span><span class="n">subdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">localCellNo</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dofLocal</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">x</span><span class="p">[</span><span class="n">dofGlobal</span><span class="p">]</span> <span class="o">=</span> <span class="n">solutions</span><span class="p">[</span><span class="n">subdomainNo</span><span class="p">][</span><span class="n">dofLocal</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">dm_global</span></div>


<div class="viewcode-block" id="getMappingToGlobalDoFMap"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.getMappingToGlobalDoFMap">[docs]</a><span class="k">def</span> <span class="nf">getMappingToGlobalDoFMap</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">meshOverlaps</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collectRank</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">meshes</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">)</span>
    <span class="n">overlapManagers</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">meshOverlaps</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">)</span>
    <span class="n">DoFMaps</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="n">collectRank</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshOverlaps</span> <span class="kn">import</span> <span class="nn">interfaceManager</span><span class="o">,</span> <span class="nn">overlapManager</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlapManagers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">overlapManager</span><span class="p">):</span>
            <span class="n">mesh_global</span><span class="p">,</span> <span class="n">localCellLookup</span> <span class="o">=</span> <span class="n">stitchOverlappingMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">overlapManagers</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlapManagers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">interfaceManager</span><span class="p">):</span>
            <span class="n">mesh_global</span><span class="p">,</span> <span class="n">localCellLookup</span> <span class="o">=</span> <span class="n">stitchNonoverlappingMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">overlapManagers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">DoFMaps</span> <span class="kn">import</span> <span class="nn">getAvailableDoFMaps</span><span class="o">,</span> <span class="nn">str2DoFMap</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">getAvailableDoFMaps</span><span class="p">():</span>
            <span class="n">DoFMap</span> <span class="o">=</span> <span class="n">str2DoFMap</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">DoFMaps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DoFMap</span><span class="p">):</span>
                <span class="n">dm_global</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="p">(</span><span class="n">mesh_global</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="p">[</span><span class="n">uninitialized</span><span class="p">((</span><span class="n">dm</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span> <span class="k">for</span> <span class="n">dm</span> <span class="ow">in</span> <span class="n">DoFMaps</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh_global</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dm_global</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
                <span class="n">dofGlobal</span> <span class="o">=</span> <span class="n">dm_global</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dofGlobal</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">subdomainNo</span><span class="p">,</span> <span class="n">localCellNo</span> <span class="ow">in</span> <span class="n">localCellLookup</span><span class="p">[</span><span class="n">cellNo</span><span class="p">]:</span>
                        <span class="n">dofLocal</span> <span class="o">=</span> <span class="n">DoFMaps</span><span class="p">[</span><span class="n">subdomainNo</span><span class="p">]</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">localCellNo</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dofLocal</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">mappings</span><span class="p">[</span><span class="n">subdomainNo</span><span class="p">][</span><span class="n">dofLocal</span><span class="p">]</span> <span class="o">=</span> <span class="n">dofGlobal</span>
        <span class="k">return</span> <span class="n">mesh_global</span><span class="p">,</span> <span class="n">dm_global</span><span class="p">,</span> <span class="n">mappings</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="accumulate2global"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.accumulate2global">[docs]</a><span class="k">def</span> <span class="nf">accumulate2global</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">meshOverlaps</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span>
                      <span class="n">comm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collectRank</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send subdomain meshes and solutions to root node, stitch together</span>
<span class="sd">    meshes and solution. Assumes that solution is already accumulated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">comm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">comm</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">meshes</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">)</span>
        <span class="n">overlapManagers</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">meshOverlaps</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">)</span>
            <span class="n">DoFMaps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vecs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">)):</span>
                <span class="n">DoFMaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">))</span>
                <span class="n">vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DoFMaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">DoFMap</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">)]</span>
            <span class="n">vecs</span> <span class="o">=</span> <span class="p">[</span><span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="n">collectRank</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshOverlaps</span> <span class="kn">import</span> <span class="nn">interfaceManager</span><span class="o">,</span> <span class="nn">overlapManager</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlapManagers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">overlapManager</span><span class="p">):</span>
                <span class="n">mesh_global</span><span class="p">,</span> <span class="n">localCellLookup</span> <span class="o">=</span> <span class="n">stitchOverlappingMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">overlapManagers</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlapManagers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">interfaceManager</span><span class="p">):</span>
                <span class="n">mesh_global</span><span class="p">,</span> <span class="n">localCellLookup</span> <span class="o">=</span> <span class="n">stitchNonoverlappingMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">overlapManagers</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">vec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">global_vecs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">global_dms</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">dms</span><span class="p">,</span> <span class="n">vectors</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">DoFMaps</span><span class="p">,</span> <span class="n">vecs</span><span class="p">):</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">dm_global</span> <span class="o">=</span> <span class="n">stitchSolutions</span><span class="p">(</span><span class="n">mesh_global</span><span class="p">,</span> <span class="n">dms</span><span class="p">,</span> <span class="n">localCellLookup</span><span class="p">,</span> <span class="n">vectors</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                    <span class="n">global_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">global_dms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dm_global</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_vecs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">global_vecs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">dm_global</span> <span class="o">=</span> <span class="n">global_dms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">global_vecs</span>
                    <span class="n">dm_global</span> <span class="o">=</span> <span class="n">global_dms</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">dm_global</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">mesh_global</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dm_global</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">vec</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">DoFMap</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">DoFMap</span></div>


<div class="viewcode-block" id="getGlobalPartitioning"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.getGlobalPartitioning">[docs]</a><span class="k">def</span> <span class="nf">getGlobalPartitioning</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">meshOverlaps</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">collectRank</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">meshes</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">)</span>
    <span class="n">overlapManagers</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">meshOverlaps</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">collectRank</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="n">collectRank</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshOverlaps</span> <span class="kn">import</span> <span class="nn">interfaceManager</span><span class="o">,</span> <span class="nn">overlapManager</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlapManagers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">overlapManager</span><span class="p">):</span>
            <span class="n">mesh_global</span><span class="p">,</span> <span class="n">localCellLookup</span> <span class="o">=</span> <span class="n">stitchOverlappingMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">overlapManagers</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlapManagers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">interfaceManager</span><span class="p">):</span>
            <span class="n">mesh_global</span><span class="p">,</span> <span class="n">localCellLookup</span> <span class="o">=</span> <span class="n">stitchNonoverlappingMeshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">overlapManagers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mesh_global</span><span class="p">,</span> <span class="n">localCellLookup</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="getSubSolution"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.getSubSolution">[docs]</a><span class="k">def</span> <span class="nf">getSubSolution</span><span class="p">(</span><span class="n">new_mesh</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">selectedCells</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">DoFMaps</span> <span class="kn">import</span> <span class="nn">getAvailableDoFMaps</span><span class="o">,</span> <span class="nn">str2DoFMap</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">getAvailableDoFMaps</span><span class="p">():</span>
        <span class="n">DoFMap</span> <span class="o">=</span> <span class="n">str2DoFMap</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">):</span>
            <span class="n">dmSub</span> <span class="o">=</span> <span class="n">DoFMap</span><span class="p">(</span><span class="n">new_mesh</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dmSub</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cellSub</span><span class="p">,</span> <span class="n">cellGlobal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selectedCells</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dmSub</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
            <span class="n">dofSub</span> <span class="o">=</span> <span class="n">dmSub</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellSub</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">dofGlobal</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cellGlobal</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dofSub</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dofGlobal</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y</span><span class="p">[</span><span class="n">dofSub</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">dofGlobal</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dmSub</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="getSubMeshSolution"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.getSubMeshSolution">[docs]</a><span class="k">def</span> <span class="nf">getSubMeshSolution</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">selectedCells</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">meshCy</span> <span class="kn">import</span> <span class="nn">getSubmesh</span>
    <span class="n">new_mesh</span> <span class="o">=</span> <span class="n">getSubmesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">selectedCells</span><span class="p">)</span>
    <span class="n">dmSub</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">getSubSolution</span><span class="p">(</span><span class="n">new_mesh</span><span class="p">,</span> <span class="n">DoFMap</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">selectedCells</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_mesh</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dmSub</span></div>


<div class="viewcode-block" id="getRestrictionProlongationSubmesh"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.getRestrictionProlongationSubmesh">[docs]</a><span class="k">def</span> <span class="nf">getRestrictionProlongationSubmesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">selectedCells</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">dm_trunc</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">PyNucleus_base.linear_operators</span> <span class="kn">import</span> <span class="n">CSR_LinearOperator</span>
    <span class="n">indptr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dm_trunc</span><span class="o">.</span><span class="n">num_dofs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dm_trunc</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">dm_trunc</span><span class="o">.</span><span class="n">num_dofs</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">REAL</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cell_trunc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">selectedCells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">selectedCells</span><span class="p">[</span><span class="n">cell_trunc</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">dofs_per_element</span><span class="p">):</span>
            <span class="n">dof</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">dof_trunc</span> <span class="o">=</span> <span class="n">dm_trunc</span><span class="o">.</span><span class="n">cell2dof_py</span><span class="p">(</span><span class="n">cell_trunc</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dof</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dof_trunc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">indices</span><span class="p">[</span><span class="n">dof_trunc</span><span class="p">]</span> <span class="o">=</span> <span class="n">dof</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">CSR_LinearOperator</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">indptr</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">R</span><span class="o">.</span><span class="n">num_columns</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">num_dofs</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">P</span></div>


<div class="viewcode-block" id="plotFunctions"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.plotFunctions">[docs]</a><span class="k">def</span> <span class="nf">plotFunctions</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">funs</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="n">functions</span> <span class="kn">import</span> <span class="nn">function</span>
    <span class="k">if</span> <span class="n">dm</span><span class="o">.</span><span class="n">num_dofs</span> <span class="o">&gt;</span> <span class="mi">50000</span> <span class="ow">or</span> <span class="n">mesh</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">funs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">funs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">funs</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">plotFunction</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">DoFMap</span><span class="o">=</span><span class="n">dm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span></div>


<div class="viewcode-block" id="plotManager"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.plotManager">[docs]</a><span class="k">class</span> <span class="nc">plotManager</span><span class="p">:</span>
<div class="viewcode-block" id="plotManager.__init__"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.plotManager.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">useSubPlots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{},</span> <span class="n">interfaces</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dm</span> <span class="o">=</span> <span class="n">dm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useSubPlots</span> <span class="o">=</span> <span class="n">useSubPlots</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">useSubPlots</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="n">defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span> <span class="o">=</span> <span class="n">interfaces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comm</span> <span class="o">=</span> <span class="n">interfaces</span><span class="o">.</span><span class="n">comm</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepared</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="plotManager.add"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.plotManager.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span></div>

<div class="viewcode-block" id="plotManager.preparePlots"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.plotManager.preparePlots">[docs]</a>    <span class="k">def</span> <span class="nf">preparePlots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">PHYSICAL</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="n">functions</span> <span class="kn">import</span> <span class="nn">function</span>
        <span class="n">solutions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">function</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">solutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">(</span><span class="n">global_mesh</span><span class="p">,</span>
         <span class="n">global_solutions</span><span class="p">,</span>
         <span class="n">global_dm</span><span class="p">)</span> <span class="o">=</span> <span class="n">accumulate2global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">),</span>
                                        <span class="n">solutions</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">global_mesh</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">global_solutions</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_solutions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dm</span> <span class="o">=</span> <span class="n">global_dm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_solutions</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dm</span> <span class="o">=</span> <span class="n">global_dm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepared</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="plotManager.plot"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.plotManager.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">legendOutside</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preparePlots</span><span class="p">()</span>

        <span class="n">needLegend</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">useSubPlots</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                    <span class="n">needLegend</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">plotFunction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">DoFMap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">needLegend</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">legendOutside</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span>
                                     <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span>
                                     <span class="n">borderaxespad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">numPlots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">)</span>
            <span class="n">plotsPerDirX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numPlots</span><span class="p">)))</span>
            <span class="n">plotsPerDirY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">numPlots</span><span class="o">/</span><span class="n">plotsPerDirX</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">)):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotsPerDirX</span><span class="p">,</span> <span class="n">plotsPerDirY</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">numPlots</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;vmin&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">plotFunction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">DoFMap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">])</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="snapMeshes"><a class="viewcode-back" href="../../PyNucleus_fem.html#PyNucleus_fem.mesh.snapMeshes">[docs]</a><span class="k">def</span> <span class="nf">snapMeshes</span><span class="p">(</span><span class="n">mesh1</span><span class="p">,</span> <span class="n">mesh2</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">KDTree</span>
    <span class="kn">from</span> <span class="nn">PyNucleus_base</span> <span class="kn">import</span> <span class="n">uninitialized</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="n">mesh1</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span>
    <span class="n">vertexCount</span> <span class="o">=</span> <span class="n">mesh1</span><span class="o">.</span><span class="n">num_vertices</span>
    <span class="n">vertexTranslation</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">mesh2</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>

    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-9</span>
    <span class="n">vertices2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">vertices_as_array</span>
    <span class="n">verticesToAdd</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">vertexNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh2</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">):</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query_ball_point</span><span class="p">(</span><span class="n">vertices2</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">,</span> <span class="p">:],</span> <span class="n">eps</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">verticesToAdd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertexNo</span><span class="p">)</span>
            <span class="n">vertexTranslation</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertexCount</span>
            <span class="n">vertexCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">vertexTranslation</span><span class="p">[</span><span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="n">neighbors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">mesh1</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">,</span>
                          <span class="n">mesh2</span><span class="o">.</span><span class="n">vertices_as_array</span><span class="p">[</span><span class="n">verticesToAdd</span><span class="p">,</span> <span class="p">:]))</span>
    <span class="n">translatedCells</span> <span class="o">=</span> <span class="n">uninitialized</span><span class="p">((</span><span class="n">mesh2</span><span class="o">.</span><span class="n">num_cells</span><span class="p">,</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">manifold_dim</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">INDEX</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cellNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh2</span><span class="o">.</span><span class="n">num_cells</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">vertexNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh2</span><span class="o">.</span><span class="n">manifold_dim</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">translatedCells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertexTranslation</span><span class="p">[</span><span class="n">mesh2</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cellNo</span><span class="p">,</span> <span class="n">vertexNo</span><span class="p">]]</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">mesh1</span><span class="o">.</span><span class="n">cells_as_array</span><span class="p">,</span>
                       <span class="n">translatedCells</span><span class="p">))</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh2d</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mesh1</span><span class="o">.</span><span class="n">transformer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">setMeshTransformation</span><span class="p">(</span><span class="n">mesh2</span><span class="o">.</span><span class="n">transformer</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">transformer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">setMeshTransformation</span><span class="p">(</span><span class="n">mesh1</span><span class="o">.</span><span class="n">transformer</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mesh</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">PyNucleus  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../PyNucleus_fem.html" >PyNucleus_fem</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">PyNucleus_fem.mesh</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Christian Glusa.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>